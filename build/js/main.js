!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,r,t){function o(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function n(e,r){return r.discount-e.discount}e.callbackFormData={},e.signFormData={},e.orderFormData={},e.subFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isSignFormSended=!1,e.issubFormSended=!1,e.isOrderFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2;var a=window.location.hash.split("/");"city"===a[1]&&(e.currentTab=2),"country"===a[1]&&(e.currentTab=3),"commerc"===a[1]&&(e.currentTab=4),e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"/sendmail.php",data:t(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var t in e.callbackFormData)e.callbackFormData[t]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3)}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-gratitude-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Подписка на Discount",r({method:"POST",url:"/sendmail.php",data:t(e.signFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.signForm.$setPristine();for(var t in e.signFormData)e.signFormData[t]="";e.isSignFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)})),console.log(e.signForm)},e.sendOrderForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"/sendmail.php",data:t(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-request").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var t in e.orderFormData)e.orderFormData[t]="";e.isOrderFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3)}))},e.sendSubForm=function(){e.subForm.$valid&&(e.subFormData.subject="Подписка на Discount",r({method:"POST",url:"/sendmail.php",data:t(e.subFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-sign").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3),e.subForm.$setPristine();for(var t in e.subFormData)e.subFormData[t]="";e.issubFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},r.get("http://www.kre.ru/landing/sale/").success(function(r){r.sort(n);for(var t=0;t<r.length;t+=1){var a=r[t];"city"==a.suptype?e.params.push({id:a.id,city:!0,rooms:parseInt(a.nb_rooms)?parseInt(a.nb_rooms)+" - ком. кв., ":" ",decoration:a.decoration||"",floor:parseInt(a.floor)?", "+(parseInt(a.floor)+"-й этаж"):"",head:a.estate,discount:parseFloat(a.discount),square:parseFloat(a.area),old_price:o(parseInt(a.old_price/1)),new_price:o(parseInt(a.new_price/1)),img:a.photo,link:a.link}):"country"==a.suptype?e.params.push({id:a.id,country:!0,desc:a.direction+", "+a.distance+" км от МКАД",head:a.estate,discount:parseFloat(a.discount),square:parseFloat(a.land_area)+" сот."||"",housearea:parseFloat(a.house_area)?", "+a.house_area+" м²":" ",old_price:o(parseInt(a.old_price)),new_price:o(parseInt(a.new_price)),img:a.photo,link:a.link}):"commerce"==a.suptype&&e.params.push({id:a.id,commerce:!0,desc:a.metro+", "+a.distance,head:a.address||a.name,discount:parseFloat(a.discount),square:parseFloat(a.area),old_price:o(parseInt(a.old_price/1)),new_price:o(parseInt(a.new_price/1)),img:a.photo,link:a.link}),e.filter=function(e,r){var t={};return angular.forEach(e,function(e,o){e[r]&&(t[o]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(o[e])}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,t){e.$last&&e.$eval(t.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsInNpZ25Gb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJzdWJGb3JtRGF0YSIsImJhcmtsaUJyb2tlckZvcm1EYXRhIiwiaXNDYWxsYmFja0Zvcm1TZW5kZWQiLCJpc1NpZ25Gb3JtU2VuZGVkIiwiaXNzdWJGb3JtU2VuZGVkIiwiaXNPcmRlckZvcm1TZW5kZWQiLCJpc0JhcmtsaUJyb2tlckZvcm1TZW5kZWQiLCJjdXJyZW50VGFiIiwibG9jYXRpb24iLCJ3aW5kb3ciLCJoYXNoIiwic3BsaXQiLCJwYXJhbXMiLCJjb3VudHJ5IiwiY29tbWVyYyIsInNob3dDYWxsYmFja1BvcHVwIiwic2VuZENhbGxiYWNrRm9ybSIsImNhbGxiYWNrRm9ybSIsIiR2YWxpZCIsIm1ldGhvZCIsInVybCIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJzdWNjZXNzIiwiJHNldFByaXN0aW5lIiwicHJvcCIsInNldFRpbWVvdXQiLCJzaG93U2lnblBvcHVwIiwic2VuZFNpZ25Gb3JtIiwic2lnbkZvcm0iLCJjb25zb2xlIiwibG9nIiwic2VuZE9yZGVyRm9ybSIsIm9yZGVyRm9ybSIsInNlbmRTdWJGb3JtIiwic3ViRm9ybSIsImdldCIsImkiLCJsZW5ndGgiLCJjdXJyZW50RmxhdCIsInN1cHR5cGUiLCJwdXNoIiwiaWQiLCJjaXR5Iiwicm9vbXMiLCJwYXJzZUludCIsImRlY29yYXRpb24iLCJmbG9vciIsImhlYWQiLCJlc3RhdGUiLCJwYXJzZUZsb2F0Iiwic3F1YXJlIiwiYXJlYSIsIm9sZF9wcmljZSIsIm5ld19wcmljZSIsImltZyIsInBob3RvIiwibGluayIsImRlc2MiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsImhvdXNlYXJlYSIsImNvbW1lcmNlIiwibWV0cm8iLCJhZGRyZXNzIiwibmFtZSIsImZpbHRlciIsIml0ZW1zIiwicmVzdWx0IiwiZm9yRWFjaCIsImtleSIsImN1cnJlbnQiLCJjZW50ZXIiLCJibG9ja3MiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JtcyIsImNoaWxkcmVuIiwiaW5zZXJ0QWZ0ZXIiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiJGxhc3QiLCIkZXZhbCIsInJlcGVhdEVuZCIsIkVsZW1lbnQiLCJlbGVtIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwic2Nyb2xsIiwic2Nyb2xsVG9wIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyJdLCJtYXBwaW5ncyI6IkNBR0EsV0FDSSxZQUVBQSxHQUFFLGtCQUFrQkMsR0FBRyxRQUFTLFdBQzVCRCxFQUFFRSxNQUFNQyxTQUFTQyxZQUFZLFdBR2pDSixFQUFFLGlCQUFpQkMsR0FBRyxVQUFXLFdBQzdCRCxFQUFFRSxNQUFNRyxNQUFNQyxLQUFNLE9BQVFDLE1BQU8sWUFDcENOLEdBQUcsV0FBWSxXQUNkRCxFQUFFRSxNQUFNRyxLQUFLLE9BQVEsVUFHekJMLEVBQUUsbUJBQW1CQyxHQUFHLFVBQVcsU0FBVU8sR0FDckNSLEVBQUVTLFFBQVFELEVBQUVF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LFVBQVV3RyxZQUFjLFNBQVNVLEdBQ3JDLE1BQU9wSSxNQUFLcUksV0FBV0MsYUFBYUYsRUFBTXBJLEtBQUt1SSxpQkFNdkR6SSxFQUFFdUQsUUFBUW1GLE9BQU8sV0FDYjFJLEVBQUVFLE1BQU15SSxZQUFjLEtBQ3hCM0ksRUFBRSxpQkFBaUI0SSxTQUFTLFVBQzVCNUksRUFBRSxpQkFBaUI2SSxZQUFZLFlBRS9CN0ksRUFBRSxpQkFBaUI2SSxZQUFZLFVBQy9CN0ksRUFBRSxpQkFBaUI0SSxTQUFTIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBsdXpoaW4uZG0gb24gMTEuMDcuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAkKCcuai1wb3B1cC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotaW5wdXQtdGltZScpLm9uKCdmb2N1c2luJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5hdHRyKHt0eXBlOiAndGltZScsIHZhbHVlOiAnMTI6MDAnfSk7XHJcbiAgICB9KS5vbignZm9jdXNvdXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoJ3R5cGUnLCAndGV4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotcGhvbmUtbWFza2VkJykub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmICgkLmluQXJyYXkoZS5rZXlDb2RlLCBbNDYsIDgsIDksIDI3LCAxMywgMTEwLCAxOTBdKSAhPT0gLTEgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA9PSA2NSAmJiAoIGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUgKSApIHx8XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDQwKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoZS5zaGlmdEtleSB8fCAoZS5rZXlDb2RlIDwgNDggfHwgZS5rZXlDb2RlID4gNTcpKSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA3KSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAkKCcuai1zY3JvbGx0by1saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAkLnNjcm9sbFRvKFxyXG4gICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3Njcm9sbHRvLWJsb2NrJyksXHJcbiAgICAgICAgICAgIHtkdXJhdGlvbjogNTAwfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG59KSgpO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbi5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtYWluJywgW10pO1xyXG5cclxuICAgIGFwcC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuc3ViRm9ybURhdGEgPSB7fVxyXG4gICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmlzc3ViRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc09yZGVyRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc0JhcmtsaUJyb2tlckZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuY3VycmVudFRhYiA9IDI7XHJcbiAgICAgICAgdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhhc2guc3BsaXQoJy8nKTtcclxuICAgICAgICBpZiAobG9jYXRpb25bMV0gPT09ICdjaXR5JykgJHNjb3BlLmN1cnJlbnRUYWIgPSAyO1xyXG4gICAgICAgIGlmIChsb2NhdGlvblsxXSA9PT0gJ2NvdW50cnknKSAkc2NvcGUuY3VycmVudFRhYiA9IDM7XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uWzFdID09PSAnY29tbWVyYycpICRzY29wZS5jdXJyZW50VGFiID0gNDtcclxuICAgICAgICAvLyRzY29wZS5jdXJyZW50VGFiID0gMztcclxuICAgICAgICAkc2NvcGUucGFyYW1zID0gW107XHJcbiAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBbXTtcclxuICAgICAgICAkc2NvcGUuY29tbWVyYyA9IFtdO1xyXG5cclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIFNUQVJUKi9cclxuXHJcbiAgICAgICAgJHNjb3BlLnNob3dDYWxsYmFja1BvcHVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQpICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1jYWxsYmFjaycpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRDYWxsYmFja0Zvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5jYWxsYmFja0Zvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YVsnc3ViamVjdCddID0gJ9CX0LDQutCw0LfQsNGC0Ywg0L7QsdGA0LDRgtC90YvQuSDQt9Cy0L7QvdC+0LouINCh0LrQuNC00LrQuC4nO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNob3dTaWduUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkKSAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRTaWduRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNpZ25Gb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpZ25Gb3JtRGF0YVsnc3ViamVjdCddID0gJ9Cf0L7QtNC/0LjRgdC60LAg0L3QsCBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLnNpZ25Gb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaWduRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5zaWduRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpZ25Gb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXNpZ24nKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5zaWduRm9ybSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKlNJR04gUE9QVVAgRU5EKi9cclxuXHJcbiAgICAgICAgLypSRVFVRVNUIEZPUk0gU0VORElORyBTVEFSVCovXHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kT3JkZXJGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUub3JkZXJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6LiDQodC60LjQtNC60LguJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUub3JkZXJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1yZXF1ZXN0JykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtcmVxdWVzdCcpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUub3JkZXJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNPcmRlckZvcm1TZW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1yZXF1ZXN0JykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kU3ViRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnN1YkZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3ViRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQn9C+0LTQv9C40YHQutCwINC90LAgRGlzY291bnQnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5zdWJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1zaWduJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLnN1YkZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNzdWJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd1NpZ25Qb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQpICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLXNpZ24nKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZnVuY3Rpb24gYWRkU3BhY2VzKG4pIHtcclxuICAgICAgICAgICAgdmFyIHJ4ID0gLyhcXGQrKShcXGR7M30pLztcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhuKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL15cXGQrLywgZnVuY3Rpb24gKHcpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocngudGVzdCh3KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3ID0gdy5yZXBsYWNlKHJ4LCAnJDEgJDInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHc7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc29ydChvYmoxLCBvYmoyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoyLmRpc2NvdW50IC0gb2JqMS5kaXNjb3VudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgJGh0dHAuZ2V0KCdodHRwOi8vd3d3LmtyZS5ydS9sYW5kaW5nL3NhbGUvJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGRhdGEuc29ydChzb3J0KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wO2k8ZGF0YS5sZW5ndGg7IGkrPTEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmxhdCA9IGRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY2l0eScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNpdHk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qZGVzYzogKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSsnIC0g0LrQvtC8LiDQutCyLiwgJytjdXJyZW50RmxhdC5kZWNvcmF0aW9uKycsICcrY3VycmVudEZsYXQuZmxvb3IrJy3QuSDRjdGC0LDQticpLCovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb21zOiAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKT8gKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSsnIC0g0LrQvtC8LiDQutCyLiwgJykgOiAnICcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlY29yYXRpb246IGN1cnJlbnRGbGF0LmRlY29yYXRpb24gfHwgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb29yOiAocGFyc2VJbnQoY3VycmVudEZsYXQuZmxvb3IpKT8gJywgJysocGFyc2VJbnQoY3VycmVudEZsYXQuZmxvb3IpICsgJy3QuSDRjdGC0LDQticpIDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmVzdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuYXJlYSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NvdW50cnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBjdXJyZW50RmxhdC5kaXJlY3Rpb24gKyAnLCAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UrJyDQutC8INC+0YIg0JzQmtCQ0JQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0WydsYW5kX2FyZWEnXSkrJyDRgdC+0YIuJyB8fCAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VhcmVhOiAocGFyc2VGbG9hdChjdXJyZW50RmxhdFsnaG91c2VfYXJlYSddKSk/ICcsICcrY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSsnINC8wrInOiAnICcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY29tbWVyY2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tZXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQubWV0cm8rICcsICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuYWRkcmVzcyB8fCBjdXJyZW50RmxhdC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVbYXR0cl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1kaXNjb3VudF9pbm5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWZvcm0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3Jtc1tjdXJyZW50XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcclxuICAgIGFwcC5kaXJlY3RpdmUoXCJyZXBlYXRFbmRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMucmVwZWF0RW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFmdGVyID0gZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

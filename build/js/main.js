!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,r,a){function t(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function o(e,r){return r.discount-e.discount}e.callbackFormData={},e.orderFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=1,e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок ЖК Андреевский",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Заказать обратный звонок ЖК Андреевский",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-sign").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendBarkliBrokerForm=function(){e.barkliBrokerForm.$valid&&(e.barkliBrokerFormData.subject="Заявка на квартиру ЖК Андреевский",e.barkliBrokerFormData.email="voronkov@kre.ru",r({method:"POST",url:"/sendmail.php",data:a(e.barkliBrokerFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.barkliBrokerForm.$setPristine();for(var a in e.barkliBrokerFormData)e.barkliBrokerFormData[a]="";e.isBarkliBrokerFormSended=!0,setTimeout(function(){$(".j-popup-barkli-broker").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},r.get("/all.json").success(function(r){r.sort(o);for(var a=0;a<r.length;a+=1){var n=r[a];"city"==n.suptype?e.params.push({id:n.id,city:!0,desc:parseInt(n.nb_rooms)+" - ком кв, "+n.decoration+", "+n.floor+"-й этаж",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:"http://www.kre.ru/offers/eliteflat/"+n.id}):"country"==n.suptype?e.params.push({id:n.id,country:!0,desc:n.direction+" "+n.distance+" км. от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)+" сот., "+parseFloat(n.house_area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:"http://www.kre.ru/offers/outoftown/"+n.id}):"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.district+" м. "+n.metro+" "+n.distance,head:n.address,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:"http://www.kre.ru/offers/comsell/"+n.id}),e.filter=function(e,r){var a={};return angular.forEach(e,function(e,t){e[r]&&(a[t]=e)}),a},e.test=function(){var e=0,r=document.querySelector(".b-discount_inner"),a=document.querySelector(".b-form");e=parseInt(r.children.length/2)%2?parseInt(r.children.length/2)+1:parseInt(r.children.length/2),r.children[e-1].insertAfter(a.cloneNode(!0)),a.parentNode.removeChild(a)}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,a){e.$last&&e.$eval(a.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkIiwiY3VycmVudFRhYiIsInBhcmFtcyIsImNvdW50cnkiLCJjb21tZXJjIiwic2hvd0NhbGxiYWNrUG9wdXAiLCJzZW5kQ2FsbGJhY2tGb3JtIiwiY2FsbGJhY2tGb3JtIiwiJHZhbGlkIiwibWV0aG9kIiwidXJsIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInN1Y2Nlc3MiLCIkc2V0UHJpc3RpbmUiLCJwcm9wIiwic2V0VGltZW91dCIsImdhIiwieWFDb3VudGVyMTk4OTU1MTIiLCJyZWFjaEdvYWwiLCJzaG93U2lnblBvcHVwIiwiaXNTaWduRm9ybVNlbmRlZCIsInNlbmRTaWduRm9ybSIsInNpZ25Gb3JtIiwic2lnbkZvcm1EYXRhIiwic2VuZEJhcmtsaUJyb2tlckZvcm0iLCJiYXJrbGlCcm9rZXJGb3JtIiwiZ2V0IiwiaSIsImxlbmd0aCIsImN1cnJlbnRGbGF0Iiwic3VwdHlwZSIsInB1c2giLCJpZCIsImNpdHkiLCJkZXNjIiwicGFyc2VJbnQiLCJkZWNvcmF0aW9uIiwiZmxvb3IiLCJoZWFkIiwiZXN0YXRlIiwicGFyc2VGbG9hdCIsInNxdWFyZSIsImFyZWEiLCJvbGRfcHJpY2UiLCJuZXdfcHJpY2UiLCJpbWciLCJwaG90byIsImxpbmsiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsImNvbW1lcmNlIiwiZGlzdHJpY3QiLCJtZXRybyIsImFkZHJlc3MiLCJmaWx0ZXIiLCJpdGVtcyIsInJlc3VsdCIsImZvckVhY2giLCJrZXkiLCJjZW50ZXIiLCJibG9jayIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImZvcm0iLCJjaGlsZHJlbiIsImluc2VydEFmdGVyIiwiY2xvbmVOb2RlIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsIiRsYXN0IiwiJGV2YWwiLCJyZXBlYXRFbmQiLCJFbGVtZW50IiwiZWxlbSIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwid2luZG93Iiwic2Nyb2xsIiwic2Nyb2xsVG9wIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyJdLCJtYXBwaW5ncyI6IkNBR0EsV0FDSSxZQUVBQSxHQUFFLGtCQUFrQkMsR0FBRyxRQUFTLFdBQzVCRCxFQUFFRSxNQUFNQyxTQUFTQyxZQUFZLFdBR2pDSixFQUFFLGlCQUFpQkMsR0FBRyxVQUFXLFdBQzdCRCxFQUFFRSxNQUFNRyxNQUFNQyxLQUFNLE9BQVFDLE1BQU8sWUFDcENOLEdBQUcsV0FBWSxXQUNkRCxFQUFFRSxNQUFNRyxLQUFLLE9BQVEsVUFHekJMLEVBQUUsbUJBQW1CQyxHQUFHLFVBQVcsU0FBVU8sR0FDckNSLEVBQUVTLFFBQVFELEVBQUVFLFNBQVUsR0FBSSxFQUFHLEVBQUcsR0FBSSxHQUFJLElBQUssWUFDL0IsSUFBYkYsRUFBRUUsVUFBbUJGLEVBQUVHLFdBQVks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RUFBS0ksV0FBV0MsWUFBWUwsVUFLNUN0RixFQUFJNEYsVUFBVSxZQUFhLFdBQ3ZCLE9BQ0lDLFNBQVUsSUFDVnZCLEtBQU0sU0FBVXdCLEVBQU9DLEVBQVNDLEdBQ3hCRixFQUFNRyxPQUNOSCxFQUFNSSxNQUFNRixFQUFNRyxlQUtsQ0MsUUFBUXpHLFVBQVU2RixZQUFjLFNBQVNhLEdBQ3JDLE1BQU81SCxNQUFLaUgsV0FBV1ksYUFBYUQsRUFBTTVILEtBQUs4SCxpQkFNdkRoSSxFQUFFaUksUUFBUUMsT0FBTyxXQUNibEksRUFBRUUsTUFBTWlJLFlBQWMsS0FDeEJuSSxFQUFFLGlCQUFpQm9JLFNBQVMsVUFDNUJwSSxFQUFFLGlCQUFpQnFJLFlBQVksWUFFL0JySSxFQUFFLGlCQUFpQnFJLFlBQVksVUFDL0JySSxFQUFFLGlCQUFpQm9JLFNBQVMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGx1emhpbi5kbSBvbiAxMS4wNy4yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICQoJy5qLXBvcHVwLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcykucGFyZW50KCkuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1pbnB1dC10aW1lJykub24oJ2ZvY3VzaW4nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoe3R5cGU6ICd0aW1lJywgdmFsdWU6ICcxMjowMCd9KTtcclxuICAgIH0pLm9uKCdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICQodGhpcykuYXR0cigndHlwZScsICd0ZXh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1waG9uZS1tYXNrZWQnKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKCQuaW5BcnJheShlLmtleUNvZGUsIFs0NiwgOCwgOSwgMjcsIDEzLCAxMTAsIDE5MF0pICE9PSAtMSB8fFxyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID09IDY1ICYmICggZS5jdHJsS2V5ID09PSB0cnVlIHx8IGUubWV0YUtleSA9PT0gdHJ1ZSApICkgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gNDApKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChlLnNoaWZ0S2V5IHx8IChlLmtleUNvZGUgPCA0OCB8fCBlLmtleUNvZGUgPiA1NykpICYmIChlLmtleUNvZGUgPCA5NiB8fCBlLmtleUNvZGUgPiAxMDcpKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvKiQoJy5qLXNsaWRlci1iZW5lZml0cycpLnNsaWNrKHtcclxuICAgICAgICBzbGlkZXNUb1Nob3c6IDQsXHJcbiAgICAgICAgc2xpZGVzVG9TY3JvbGw6IDQsXHJcbiAgICAgICAgc3BlZWQ6IDE1MCxcclxuICAgICAgICByZXNwb25zaXZlOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQ6IDcwMCxcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1zbGlkZXItZXhwZXJpZW5jZScpLnNsaWNrKHtcclxuICAgICAgICBtb2JpbGVGaXJzdDogdHJ1ZSxcclxuICAgICAgICBzbGlkZXNUb1Nob3c6IDEsXHJcbiAgICAgICAgc3BlZWQ6IDE1MCxcclxuICAgICAgICByZXNwb25zaXZlOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrcG9pbnQ6IDc4MCxcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzOiAndW5zbGljaydcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF1cclxuICAgIH0pOyovXHJcblxyXG4gICAgLyp5bWFwcy5yZWFkeShpbml0TWFwKTtcclxuICAgIHZhciBteU1hcDtcclxuICAgIHZhciBteVBsYWNlbWFyaztcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0TWFwKCkge1xyXG4gICAgICAgIG15TWFwID0gbmV3IHltYXBzLk1hcCgnbWFwJywge1xyXG4gICAgICAgICAgICBjZW50ZXI6IFs1NS43ODY1ODY1MzYxODM4OCwgMzcuNjE2NzIyMzU4NjU3MzVdLFxyXG4gICAgICAgICAgICB6b29tOiAxNVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoWzU1Ljc4NjU4NjUzNjE4Mzg4LCAzNy42MTY3MjIzNTg2NTczNV0sIHt9LCB7XHJcbiAgICAgICAgICAgIGljb25JbWFnZUhyZWY6ICcvaW1nL21hcC1pY29uLnBuZycsXHJcbiAgICAgICAgICAgIGljb25JbWFnZVNpemU6IFs3MywgOTVdLFxyXG4gICAgICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMTUsIC05NV0sXHJcbiAgICAgICAgICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XHJcbiAgICAgICAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoXCJzY3JvbGxab29tXCIpO1xyXG4gICAgICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdkcmFnJyk7XHJcbiAgICB9Ki9cclxuXHJcbiAgICAkKCcuai1zY3JvbGx0by1saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAkLnNjcm9sbFRvKFxyXG4gICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3Njcm9sbHRvLWJsb2NrJyksXHJcbiAgICAgICAgICAgIHtkdXJhdGlvbjogNTAwfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG59KSgpO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbi5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtYWluJywgW10pO1xyXG5cclxuICAgIGFwcC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc0JhcmtsaUJyb2tlckZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuY3VycmVudFRhYiA9IDE7XHJcbiAgICAgICAgJHNjb3BlLnBhcmFtcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb3VudHJ5ID0gW107XHJcbiAgICAgICAgJHNjb3BlLmNvbW1lcmMgPSBbXTtcclxuXHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBTVEFSVCovXHJcblxyXG4gICAgICAgICRzY29wZS5zaG93Q2FsbGJhY2tQb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkKSAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kQ2FsbGJhY2tGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2FsbGJhY2tGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6INCW0Jog0JDQvdC00YDQtdC10LLRgdC60LjQuSc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1jYWxsYmFjaycpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNob3dTaWduUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkKSAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1zaWduJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZFNpZ25Gb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2lnbkZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7QuiDQltCaINCQ0L3QtNGA0LXQtdCy0YHQutC40LknO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKlNJR04gUE9QVVAgRU5EKi9cclxuXHJcbiAgICAgICAgLypTRU5ESU5HIEVNQUlMIFRPIEJST0tFUiBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNlbmRCYXJrbGlCcm9rZXJGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYmFya2xpQnJva2VyRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YVsnc3ViamVjdCddID0gJ9CX0LDRj9Cy0LrQsCDQvdCwINC60LLQsNGA0YLQuNGA0YMg0JbQmiDQkNC90LTRgNC10LXQstGB0LrQuNC5JztcclxuICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YVsnZW1haWwnXSA9ICd2b3JvbmtvdkBrcmUucnUnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1iYXJrbGktYnJva2VyJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKlNFTkRJTkcgRU1BSUwgVE8gQlJPS0VSIEVORCovXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFNwYWNlcyhuKSB7XHJcbiAgICAgICAgICAgIHZhciByeCA9IC8oXFxkKykoXFxkezN9KS87XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxkKy8sIGZ1bmN0aW9uICh3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJ4LnRlc3QodykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHcucmVwbGFjZShyeCwgJyQxICQyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHNvcnQob2JqMSwgb2JqMikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqMi5kaXNjb3VudCAtIG9iajEuZGlzY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICRodHRwLmdldCgnL2FsbC5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGRhdGEuc29ydChzb3J0KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wO2k8ZGF0YS5sZW5ndGg7IGkrPTEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmxhdCA9IGRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY2l0eScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNpdHk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSsnIC0g0LrQvtC8INC60LIsICcrY3VycmVudEZsYXQuZGVjb3JhdGlvbisnLCAnK2N1cnJlbnRGbGF0LmZsb29yKyct0Lkg0Y3RgtCw0LYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmFyZWEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiAnaHR0cDovL3d3dy5rcmUucnUvb2ZmZXJzL2VsaXRlZmxhdC8nK2N1cnJlbnRGbGF0LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb3VudHJ5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQuZGlyZWN0aW9uICsgJyAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UrJyDQutC8LiDQvtGCINCc0JrQkNCUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuZXN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdFsnbGFuZF9hcmVhJ10pKycg0YHQvtGCLiwgJytwYXJzZUZsb2F0KGN1cnJlbnRGbGF0Wydob3VzZV9hcmVhJ10pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiAnaHR0cDovL3d3dy5rcmUucnUvb2ZmZXJzL291dG9mdG93bi8nK2N1cnJlbnRGbGF0LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb21tZXJjZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lcmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBjdXJyZW50RmxhdC5kaXN0cmljdCsnINC8LicrICcgJyArIGN1cnJlbnRGbGF0Lm1ldHJvKyAnICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuYWRkcmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuYXJlYSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6ICdodHRwOi8vd3d3LmtyZS5ydS9vZmZlcnMvY29tc2VsbC8nK2N1cnJlbnRGbGF0LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oaXRlbXMsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVthdHRyXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gMCwgYmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYi1kaXNjb3VudF9pbm5lcicpLCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmItZm9ybScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChibG9jay5jaGlsZHJlbi5sZW5ndGgvMiklMikgY2VudGVyID0gcGFyc2VJbnQoYmxvY2suY2hpbGRyZW4ubGVuZ3RoLzIpKzE7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBjZW50ZXIgPSBwYXJzZUludChibG9jay5jaGlsZHJlbi5sZW5ndGgvMik7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suY2hpbGRyZW5bY2VudGVyLTFdLmluc2VydEFmdGVyKGZvcm0uY2xvbmVOb2RlKHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZm9ybSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcclxuICAgIGFwcC5kaXJlY3RpdmUoXCJyZXBlYXRFbmRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMucmVwZWF0RW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFmdGVyID0gZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,r,a){function o(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function t(e,r){return r.discount-e.discount}e.callbackFormData={},e.orderFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isSignFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2,e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Заказать обратный звонок Discount",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-sign").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendBarkliBrokerForm=function(){e.barkliBrokerForm.$valid&&(e.barkliBrokerFormData.subject="Заявка на квартиру Discount",e.barkliBrokerFormData.email="sales@kre.ru",r({method:"POST",url:"/sendmail.php",data:a(e.barkliBrokerFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.barkliBrokerForm.$setPristine();for(var a in e.barkliBrokerFormData)e.barkliBrokerFormData[a]="";e.isBarkliBrokerFormSended=!0,setTimeout(function(){$(".j-popup-barkli-broker").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendOrderForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Disc",r({method:"POST",url:"/sendmail.php",data:a(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var a in e.orderFormData)e.orderFormData[a]="";ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")})),console.log(e.orderForm)},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSubscribeForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Disc",r({method:"POST",url:"/sendmail.php",data:a(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var a in e.orderFormData)e.orderFormData[a]="";ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")})),console.log(e.orderForm)},r.get("http://www.kre.ru/landing/sale/").success(function(r){r.sort(t);for(var a=0;a<r.length;a+=1){var n=r[a];"city"==n.suptype?e.params.push({id:n.id,city:!0,rooms:parseInt(n.nb_rooms)?parseInt(n.nb_rooms)+" - ком. кв., ":" ",decoration:n.decoration||"",floor:parseInt(n.floor)?", "+(parseInt(n.floor)+"-й этаж"):"",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}):"country"==n.suptype?e.params.push({id:n.id,country:!0,desc:n.direction+" "+n.distance+" км от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)+" сот."||"",housearea:parseFloat(n.house_area)?", "+n.house_area+" м²":" ",old_price:o(parseInt(n.old_price)),new_price:o(parseInt(n.new_price)),img:n.photo,link:n.link}):"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.metro+" "+n.distance,head:n.address||n.name,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.filter=function(e,r){var a={};return angular.forEach(e,function(e,o){e[r]&&(a[o]=e)}),a},e.test=function(e){var r=0,a=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(a[e].children.length/2)%2?parseInt(a[e].children.length/2)+1:parseInt(a[e].children.length/2),a[e].children[r-1].insertAfter(o[e])}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,a){e.$last&&e.$eval(a.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNTaWduRm9ybVNlbmRlZCIsImlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCIsImN1cnJlbnRUYWIiLCJwYXJhbXMiLCJjb3VudHJ5IiwiY29tbWVyYyIsInNob3dDYWxsYmFja1BvcHVwIiwic2VuZENhbGxiYWNrRm9ybSIsImNhbGxiYWNrRm9ybSIsIiR2YWxpZCIsIm1ldGhvZCIsInVybCIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJzdWNjZXNzIiwiJHNldFByaXN0aW5lIiwicHJvcCIsInNldFRpbWVvdXQiLCJnYSIsInlhQ291bnRlcjE5ODk1NTEyIiwicmVhY2hHb2FsIiwic2hvd1NpZ25Qb3B1cCIsInNlbmRTaWduRm9ybSIsInNpZ25Gb3JtIiwic2lnbkZvcm1EYXRhIiwic2VuZEJhcmtsaUJyb2tlckZvcm0iLCJiYXJrbGlCcm9rZXJGb3JtIiwic2VuZE9yZGVyRm9ybSIsIm9yZGVyRm9ybSIsImNvbnNvbGUiLCJsb2ciLCJzZW5kU3Vic2NyaWJlRm9ybSIsImdldCIsImkiLCJsZW5ndGgiLCJjdXJyZW50RmxhdCIsInN1cHR5cGUiLCJwdXNoIiwiaWQiLCJjaXR5Iiwicm9vbXMiLCJwYXJzZUludCIsImRlY29yYXRpb24iLCJmbG9vciIsImhlYWQiLCJlc3RhdGUiLCJwYXJzZUZsb2F0Iiwic3F1YXJlIiwiYXJlYSIsIm9sZF9wcmljZSIsIm5ld19wcmljZSIsImltZyIsInBob3RvIiwibGluayIsImRlc2MiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsImhvdXNlYXJlYSIsImNvbW1lcmNlIiwibWV0cm8iLCJhZGRyZXNzIiwibmFtZSIsImZpbHRlciIsIml0ZW1zIiwicmVzdWx0IiwiZm9yRWFjaCIsImtleSIsImN1cnJlbnQiLCJjZW50ZXIiLCJibG9ja3MiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JtcyIsImNoaWxkcmVuIiwiaW5zZXJ0QWZ0ZXIiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiJGxhc3QiLCIkZXZhbCIsInJlcGVhdEVuZCIsIkVsZW1lbnQiLCJlbGVtIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwid2luZG93Iiwic2Nyb2xsIiwic2Nyb2xsVG9wIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyJdLCJtYXBwaW5ncyI6IkNBR0EsV0FDSSxZQUVBQSxHQUFFLGtCQUFrQkMsR0FBRyxRQUFTLFdBQzVCRCxFQUFFRSxNQUFNQyxTQUFTQyxZQUFZLFdBR2pDSixFQUFFLGlCQUFpQkMsR0FBRyxVQUFXLFdBQzdCRCxFQUFFRSxNQUFNRyxNQUFNQyxLQUFNLE9BQVFDLE1BQU8sWUFDcENOLEdBQUcsV0FBWSxXQUNkRCxFQUFFRSxNQUFNRyxLQUFLLE9BQVEsVUFHekJMLEVBQUUsbUJBQW1CQyxHQUFHLFVBQVcsU0FBVU8sR0FDckNSLEVBQUVTLFFBQVFELEVBQUVFLFNB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R0FBRyxFQUNuQ08sU0FBUzRCLEVBQU9GLEdBQVNNLFNBQVN2QyxPQUFTLEdBQUssRUFHaERPLFNBQVM0QixFQUFPRixHQUFTTSxTQUFTdkMsT0FBTyxHQUV0RG1DLEVBQU9GLEdBQVNNLFNBQVNMLEVBQU8sR0FBR00sWUFBWUYsRUFBTUwsV0FLckV6RixFQUFJaUcsVUFBVSxZQUFhLFdBQ3ZCLE9BQ0lDLFNBQVUsSUFDVnZCLEtBQU0sU0FBVXdCLEVBQU9DLEVBQVNDLEdBQ3hCRixFQUFNRyxPQUNOSCxFQUFNSSxNQUFNRixFQUFNRyxlQUtsQ0MsUUFBUTlHLFVBQVVxRyxZQUFjLFNBQVNVLEdBQ3JDLE1BQU9qSSxNQUFLa0ksV0FBV0MsYUFBYUYsRUFBTWpJLEtBQUtvSSxpQkFNdkR0SSxFQUFFdUksUUFBUUMsT0FBTyxXQUNieEksRUFBRUUsTUFBTXVJLFlBQWMsS0FDeEJ6SSxFQUFFLGlCQUFpQjBJLFNBQVMsVUFDNUIxSSxFQUFFLGlCQUFpQjJJLFlBQVksWUFFL0IzSSxFQUFFLGlCQUFpQjJJLFlBQVksVUFDL0IzSSxFQUFFLGlCQUFpQjBJLFNBQVMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGx1emhpbi5kbSBvbiAxMS4wNy4yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICQoJy5qLXBvcHVwLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcykucGFyZW50KCkuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1pbnB1dC10aW1lJykub24oJ2ZvY3VzaW4nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoe3R5cGU6ICd0aW1lJywgdmFsdWU6ICcxMjowMCd9KTtcclxuICAgIH0pLm9uKCdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICQodGhpcykuYXR0cigndHlwZScsICd0ZXh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1waG9uZS1tYXNrZWQnKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKCQuaW5BcnJheShlLmtleUNvZGUsIFs0NiwgOCwgOSwgMjcsIDEzLCAxMTAsIDE5MF0pICE9PSAtMSB8fFxyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID09IDY1ICYmICggZS5jdHJsS2V5ID09PSB0cnVlIHx8IGUubWV0YUtleSA9PT0gdHJ1ZSApICkgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gNDApKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChlLnNoaWZ0S2V5IHx8IChlLmtleUNvZGUgPCA0OCB8fCBlLmtleUNvZGUgPiA1NykpICYmIChlLmtleUNvZGUgPCA5NiB8fCBlLmtleUNvZGUgPiAxMDcpKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgICQoJy5qLXNjcm9sbHRvLWxpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICQuc2Nyb2xsVG8oXHJcbiAgICAgICAgICAgICQodGhpcykuZGF0YSgnc2Nyb2xsdG8tYmxvY2snKSxcclxuICAgICAgICAgICAge2R1cmF0aW9uOiA1MDB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBBcnJheS5wcm90b3R5cGUubWF4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIHRoaXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBBcnJheS5wcm90b3R5cGUubWluID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KG51bGwsIHRoaXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ21haW4nLCBbXSk7XHJcblxyXG4gICAgYXBwLmNvbnRyb2xsZXIoJ21haW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSkge1xyXG5cclxuICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRUYWIgPSAyO1xyXG4gICAgICAgICRzY29wZS5wYXJhbXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuY291bnRyeSA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb21tZXJjID0gW107XHJcblxyXG4gICAgICAgIC8qQ0FMTEJBQ0sgUE9QVVAgU1RBUlQqL1xyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd0NhbGxiYWNrUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCkgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLWNhbGxiYWNrJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZENhbGxiYWNrRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNhbGxiYWNrRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7Quic7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1jYWxsYmFjaycpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNob3dTaWduUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkKSAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1zaWduJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZFNpZ25Gb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2lnbkZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7QuiBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1zaWduJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlNFTkRJTkcgRU1BSUwgVE8gQlJPS0VSIFNUQVJUKi9cclxuICAgICAgICAkc2NvcGUuc2VuZEJhcmtsaUJyb2tlckZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5iYXJrbGlCcm9rZXJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNGP0LLQutCwINC90LAg0LrQstCw0YDRgtC40YDRgyBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbJ2VtYWlsJ10gPSAnc2FsZXNAa3JlLnJ1JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtYmFya2xpLWJyb2tlcicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypTRU5ESU5HIEVNQUlMIFRPIEJST0tFUiBFTkQqL1xyXG5cclxuICAgICAgICAvKlJFUVVFU1QgRk9STSBTRU5ESU5HIFNUQVJUKi9cclxuICAgICAgICAkc2NvcGUuc2VuZE9yZGVyRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm9yZGVyRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhWydzdWJqZWN0J10gPSAnRGlzYyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLm9yZGVyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUnKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZScpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUub3JkZXJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdjYWxsYmFjaycsICdjbGljayBidXR0b24nKTtcclxuICAgICAgICAgICAgICAgICAgICB5YUNvdW50ZXIxOTg5NTUxMi5yZWFjaEdvYWwoJ2NhbGxiYWNrJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUub3JkZXJGb3JtKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd1NpZ25Qb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQpICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLXNpZ24nKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLnNlbmRTdWJzY3JpYmVGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUub3JkZXJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGFbJ3N1YmplY3QnXSA9ICdEaXNjJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUub3JkZXJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZScpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5vcmRlckZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5vcmRlckZvcm0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLypSRVFVRVNUIEZPUk0gU0VORElORyBFTkQqL1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRTcGFjZXMobikge1xyXG4gICAgICAgICAgICB2YXIgcnggPSAvKFxcZCspKFxcZHszfSkvO1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKG4pXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXlxcZCsvLCBmdW5jdGlvbiAodykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyeC50ZXN0KHcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB3LnJlcGxhY2UocngsICckMSAkMicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzb3J0KG9iajEsIG9iajIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9iajIuZGlzY291bnQgLSBvYmoxLmRpc2NvdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAkaHR0cC5nZXQoJ2h0dHA6Ly93d3cua3JlLnJ1L2xhbmRpbmcvc2FsZS8nKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7aTxkYXRhLmxlbmd0aDsgaSs9MSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGbGF0ID0gZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLypkZXNjOiAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKycgLSDQutC+0LwuINC60LIuLCAnK2N1cnJlbnRGbGF0LmRlY29yYXRpb24rJywgJytjdXJyZW50RmxhdC5mbG9vcisnLdC5INGN0YLQsNC2JyksKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbXM6IChwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkpPyAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKycgLSDQutC+0LwuINC60LIuLCAnKSA6ICcgJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVjb3JhdGlvbjogY3VycmVudEZsYXQuZGVjb3JhdGlvbiB8fCAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3I6IChwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikpPyAnLCAnKyhwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikgKyAnLdC5INGN0YLQsNC2JykgOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuZXN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY291bnRyeScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGN1cnJlbnRGbGF0LmRpcmVjdGlvbiArICcgJyArIGN1cnJlbnRGbGF0LmRpc3RhbmNlKycg0LrQvCDQvtGCINCc0JrQkNCUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuZXN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdFsnbGFuZF9hcmVhJ10pKycg0YHQvtGCLicgfHwgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXNlYXJlYTogKHBhcnNlRmxvYXQoY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSkpPyAnLCAnK2N1cnJlbnRGbGF0Wydob3VzZV9hcmVhJ10rJyDQvMKyJzogJyAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NvbW1lcmNlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVyY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGN1cnJlbnRGbGF0Lm1ldHJvKyAnICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuYWRkcmVzcyB8fCBjdXJyZW50RmxhdC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVbYXR0cl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1kaXNjb3VudF9pbm5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWZvcm0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3Jtc1tjdXJyZW50XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcclxuICAgIGFwcC5kaXJlY3RpdmUoXCJyZXBlYXRFbmRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMucmVwZWF0RW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFmdGVyID0gZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,r,a){function o(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function t(e,r){return r.discount-e.discount}e.callbackFormData={},e.orderFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2,e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Заказать обратный звонок Discount",r({method:"POST",url:"/sendmail.php",data:a(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var a in e.callbackFormData)e.callbackFormData[a]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-sign").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendBarkliBrokerForm=function(){e.barkliBrokerForm.$valid&&(e.barkliBrokerFormData.subject="Заявка на квартиру Discount",e.barkliBrokerFormData.email="sales@kre.ru",r({method:"POST",url:"/sendmail.php",data:a(e.barkliBrokerFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.barkliBrokerForm.$setPristine();for(var a in e.barkliBrokerFormData)e.barkliBrokerFormData[a]="";e.isBarkliBrokerFormSended=!0,setTimeout(function(){$(".j-popup-barkli-broker").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},r.get("http://www.kre.ru/landing/sale/").success(function(r){r.sort(t);for(var a=0;a<r.length;a+=1){var n=r[a];"city"==n.suptype?e.params.push({id:n.id,city:!0,rooms:parseInt(n.nb_rooms)?parseInt(n.nb_rooms)+" - ком. кв., ":" ",decoration:n.decoration||"",floor:parseInt(n.floor)?parseInt(n.floor)+"-й этаж":"",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}):"country"==n.suptype?e.params.push({id:n.id,country:!0,desc:n.direction+" "+n.distance+" км от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)+" сот."||"",housearea:parseFloat(n.house_area)?", "+n.house_area+" м²":" ",old_price:o(parseInt(n.old_price)),new_price:o(parseInt(n.new_price)),img:n.photo,link:n.link}):"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.metro+" "+n.distance,head:n.address||n.name,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.filter=function(e,r){var a={};return angular.forEach(e,function(e,o){e[r]&&(a[o]=e)}),a},e.test=function(e){var r=0,a=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(a[e].children.length/2)%2?parseInt(a[e].children.length/2)+1:parseInt(a[e].children.length/2),a[e].children[r-1].insertAfter(o[e].cloneNode(!0)),o[e].parentNode.removeChild(o[e])}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,a){e.$last&&e.$eval(a.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkIiwiY3VycmVudFRhYiIsInBhcmFtcyIsImNvdW50cnkiLCJjb21tZXJjIiwic2hvd0NhbGxiYWNrUG9wdXAiLCJzZW5kQ2FsbGJhY2tGb3JtIiwiY2FsbGJhY2tGb3JtIiwiJHZhbGlkIiwibWV0aG9kIiwidXJsIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInN1Y2Nlc3MiLCIkc2V0UHJpc3RpbmUiLCJwcm9wIiwic2V0VGltZW91dCIsImdhIiwieWFDb3VudGVyMTk4OTU1MTIiLCJyZWFjaEdvYWwiLCJzaG93U2lnblBvcHVwIiwiaXNTaWduRm9ybVNlbmRlZCIsInNlbmRTaWduRm9ybSIsInNpZ25Gb3JtIiwic2lnbkZvcm1EYXRhIiwic2VuZEJhcmtsaUJyb2tlckZvcm0iLCJiYXJrbGlCcm9rZXJGb3JtIiwiZ2V0IiwiaSIsImxlbmd0aCIsImN1cnJlbnRGbGF0Iiwic3VwdHlwZSIsInB1c2giLCJpZCIsImNpdHkiLCJyb29tcyIsInBhcnNlSW50IiwiZGVjb3JhdGlvbiIsImZsb29yIiwiaGVhZCIsImVzdGF0ZSIsInBhcnNlRmxvYXQiLCJzcXVhcmUiLCJhcmVhIiwib2xkX3ByaWNlIiwibmV3X3ByaWNlIiwiaW1nIiwicGhvdG8iLCJsaW5rIiwiZGVzYyIsImRpcmVjdGlvbiIsImRpc3RhbmNlIiwiaG91c2VhcmVhIiwiY29tbWVyY2UiLCJtZXRybyIsImFkZHJlc3MiLCJuYW1lIiwiZmlsdGVyIiwiaXRlbXMiLCJyZXN1bHQiLCJmb3JFYWNoIiwia2V5IiwiY3VycmVudCIsImNlbnRlciIsImJsb2NrcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1zIiwiY2hpbGRyZW4iLCJpbnNlcnRBZnRlciIsImNsb25lTm9kZSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsImRpcmVjdGl2ZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCIkbGFzdCIsIiRldmFsIiwicmVwZWF0RW5kIiwiRWxlbWVudCIsImVsZW0iLCJpbnNlcnRCZWZvcmUiLCJuZXh0U2libGluZyIsIndpbmRvdyIsInNjcm9sbCIsInNjcm9sbFRvcCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiXSwibWFwcGluZ3MiOiJDQUdBLFdBQ0ksWUFFQUEsR0FBRSxrQkFBa0JDLEdBQUcsUUFBUyxXQUM1QkQsRUFBRUUsTUFBTUMsU0FBU0MsWUFBWSxXQUdqQ0osRUFBRSxpQkFBaUJDLEdBQUcsVUFBVyxXQUM3QkQsRUFBRUUsTUFBTUcsTUFBTUMsS0FBTSxPQUFRQyxNQUFPLFlBQ3BDTixHQUFHLFdBQVksV0FDZEQsRUFBRUUsTUFBTUcsS0FBSyxPQUFRLFVBR3pCTCxFQUFFLG1CQUFtQkMsR0FBRyxVQUFXLFNBQVVPLEdBQ3JDUixFQUFFUyxRQUFRRCxFQUFFRSxTQUFVLEdBQUksRUFBRyxFQUFHLEdBQUksR0FBSSxJQUFLLFlBQy9C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RUFDbkNPLFNBQVM0QixFQUFPRixHQUFTTSxTQUFTdkMsT0FBUyxHQUFLLEVBR2hETyxTQUFTNEIsRUFBT0YsR0FBU00sU0FBU3ZDLE9BQU8sR0FFdERtQyxFQUFPRixHQUFTTSxTQUFTTCxFQUFPLEdBQUdNLFlBQVlGLEVBQU1MLEdBQVNRLFdBQVUsSUFDeEVILEVBQU1MLEdBQVNTLFdBQVdDLFlBQVlMLEVBQU1MLFdBSzVEcEYsRUFBSStGLFVBQVUsWUFBYSxXQUN2QixPQUNJQyxTQUFVLElBQ1YxQixLQUFNLFNBQVUyQixFQUFPQyxFQUFTQyxHQUN4QkYsRUFBTUcsT0FDTkgsRUFBTUksTUFBTUYsRUFBTUcsZUFLbENDLFFBQVE1RyxVQUFVZ0csWUFBYyxTQUFTYSxHQUNyQyxNQUFPL0gsTUFBS29ILFdBQVdZLGFBQWFELEVBQU0vSCxLQUFLaUksaUJBa0J2RG5JLEVBQUVvSSxRQUFRQyxPQUFPLFdBQ2JySSxFQUFFRSxNQUFNb0ksWUFBYyxLQUN4QnRJLEVBQUUsaUJBQWlCdUksU0FBUyxVQUM1QnZJLEVBQUUsaUJBQWlCd0ksWUFBWSxZQUUvQnhJLEVBQUUsaUJBQWlCd0ksWUFBWSxVQUMvQnhJLEVBQUUsaUJBQWlCdUksU0FBUyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgJCgnLmotcG9wdXAtY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5qLWlucHV0LXRpbWUnKS5vbignZm9jdXNpbicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICQodGhpcykuYXR0cih7dHlwZTogJ3RpbWUnLCB2YWx1ZTogJzEyOjAwJ30pO1xyXG4gICAgfSkub24oJ2ZvY3Vzb3V0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5qLXBob25lLW1hc2tlZCcpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoJC5pbkFycmF5KGUua2V5Q29kZSwgWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXSkgIT09IC0xIHx8XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPT0gNjUgJiYgKCBlLmN0cmxLZXkgPT09IHRydWUgfHwgZS5tZXRhS2V5ID09PSB0cnVlICkgKSB8fFxyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID49IDM1ICYmIGUua2V5Q29kZSA8PSA0MCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKGUuc2hpZnRLZXkgfHwgKGUua2V5Q29kZSA8IDQ4IHx8IGUua2V5Q29kZSA+IDU3KSkgJiYgKGUua2V5Q29kZSA8IDk2IHx8IGUua2V5Q29kZSA+IDEwNykpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgJCgnLmotc2Nyb2xsdG8tbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgJC5zY3JvbGxUbyhcclxuICAgICAgICAgICAgJCh0aGlzKS5kYXRhKCdzY3JvbGx0by1ibG9jaycpLFxyXG4gICAgICAgICAgICB7ZHVyYXRpb246IDUwMH1cclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG5cclxufSkoKTtcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIEFycmF5LnByb3RvdHlwZS5tYXggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgdGhpcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIEFycmF5LnByb3RvdHlwZS5taW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5taW4uYXBwbHkobnVsbCwgdGhpcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbWFpbicsIFtdKTtcclxuXHJcbiAgICBhcHAuY29udHJvbGxlcignbWFpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZScsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKSB7XHJcblxyXG4gICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRUYWIgPSAyO1xyXG4gICAgICAgICRzY29wZS5wYXJhbXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuY291bnRyeSA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb21tZXJjID0gW107XHJcblxyXG4gICAgICAgIC8qQ0FMTEJBQ0sgUE9QVVAgU1RBUlQqL1xyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd0NhbGxiYWNrUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCkgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLWNhbGxiYWNrJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZENhbGxiYWNrRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNhbGxiYWNrRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7Quic7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1jYWxsYmFjaycpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNob3dTaWduUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkKSAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1zaWduJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZFNpZ25Gb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc2lnbkZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7QuiBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1zaWduJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlNFTkRJTkcgRU1BSUwgVE8gQlJPS0VSIFNUQVJUKi9cclxuICAgICAgICAkc2NvcGUuc2VuZEJhcmtsaUJyb2tlckZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5iYXJrbGlCcm9rZXJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNGP0LLQutCwINC90LAg0LrQstCw0YDRgtC40YDRgyBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbJ2VtYWlsJ10gPSAnc2FsZXNAa3JlLnJ1JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtYmFya2xpLWJyb2tlcicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypTRU5ESU5HIEVNQUlMIFRPIEJST0tFUiBFTkQqL1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRTcGFjZXMobikge1xyXG4gICAgICAgICAgICB2YXIgcnggPSAvKFxcZCspKFxcZHszfSkvO1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKG4pXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXlxcZCsvLCBmdW5jdGlvbiAodykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyeC50ZXN0KHcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB3LnJlcGxhY2UocngsICckMSAkMicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzb3J0KG9iajEsIG9iajIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9iajIuZGlzY291bnQgLSBvYmoxLmRpc2NvdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAkaHR0cC5nZXQoJ2h0dHA6Ly93d3cua3JlLnJ1L2xhbmRpbmcvc2FsZS8nKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7aTxkYXRhLmxlbmd0aDsgaSs9MSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGbGF0ID0gZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLypkZXNjOiAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKycgLSDQutC+0LwuINC60LIuLCAnK2N1cnJlbnRGbGF0LmRlY29yYXRpb24rJywgJytjdXJyZW50RmxhdC5mbG9vcisnLdC5INGN0YLQsNC2JyksKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbXM6IChwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkpPyAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKycgLSDQutC+0LwuINC60LIuLCAnKSA6ICcgJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVjb3JhdGlvbjogY3VycmVudEZsYXQuZGVjb3JhdGlvbiB8fCAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3I6IChwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikpPyAocGFyc2VJbnQoY3VycmVudEZsYXQuZmxvb3IpICsgJy3QuSDRjdGC0LDQticpIDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmVzdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuYXJlYSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NvdW50cnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBjdXJyZW50RmxhdC5kaXJlY3Rpb24gKyAnICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSsnINC60Lwg0L7RgiDQnNCa0JDQlCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmVzdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXRbJ2xhbmRfYXJlYSddKSsnINGB0L7Rgi4nIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBob3VzZWFyZWE6IChwYXJzZUZsb2F0KGN1cnJlbnRGbGF0Wydob3VzZV9hcmVhJ10pKT8gJywgJytjdXJyZW50RmxhdFsnaG91c2VfYXJlYSddKycg0LzCsic6ICcgJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBjdXJyZW50RmxhdC5saW5rXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb21tZXJjZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lcmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBjdXJyZW50RmxhdC5tZXRybysgJyAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmFkZHJlc3MgfHwgY3VycmVudEZsYXQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuYXJlYSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbihpdGVtcywgYXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlW2F0dHJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZGlzY291bnRfaW5uZXInKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1mb3JtJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpJTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aCAvIDIpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbltjZW50ZXItMV0uaW5zZXJ0QWZ0ZXIoZm9ybXNbY3VycmVudF0uY2xvbmVOb2RlKHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3Jtc1tjdXJyZW50XS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZvcm1zW2N1cnJlbnRdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xyXG4gICAgYXBwLmRpcmVjdGl2ZShcInJlcGVhdEVuZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJGxhc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5yZXBlYXRFbmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgRWxlbWVudC5wcm90b3R5cGUuaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbihlbGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbSwgdGhpcy5uZXh0U2libGluZyk7XHJcbiAgICB9O1xyXG4gICB2YXIgIHRlc3QgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgdmFyIGNlbnRlciA9IDAsIGJsb2NrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmItZGlzY291bnRfaW5uZXInKSwgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5iLWZvcm0nKTtcclxuICAgICAgICBpZiAocGFyc2VJbnQoYmxvY2suY2hpbGRyZW4ubGVuZ3RoLzIpJTIpIHtcclxuICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2suY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2suY2hpbGRyZW4ubGVuZ3RoLzIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBibG9jay5jaGlsZHJlbltjZW50ZXItMV0uaW5zZXJ0QWZ0ZXIoZm9ybS5jbG9uZU5vZGUodHJ1ZSkpO1xyXG4gICAgICAgIGZvcm0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmb3JtKTtcclxuICAgIH1cclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$cacheFactory","$httpParamSerializerJQLike",function(e,r,t,n){function o(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function a(e,r){return r.discount-e.discount}function i(){2==e.currentTab&&e.loadedTabs.indexOf(2)===-1?r.get("http://www.kre.ru/landing/sale/?suptype=city").success(function(r){e.loadedTabs.push(2),r.sort(a);for(var t=0;t<r.length;t+=1){var n=r[t];"city"==n.suptype&&e.params.push({id:n.id,city:!0,rooms:parseInt(n.nb_rooms)?parseInt(n.nb_rooms)+" - ком. кв., ":" ",decoration:n.decoration||"",floor:parseInt(n.floor)?", "+(parseInt(n.floor)+"-й этаж"):"",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.AbsentEmployees.employees=r,s.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,n){e[r]&&(t[n]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),n=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(n[e])}}}):3==e.currentTab&&e.loadedTabs.indexOf(3)===-1?r.get("http://www.kre.ru/landing/sale/?suptype=country").success(function(r){e.loadedTabs.push(3),r.sort(a);for(var t=0;t<r.length;t+=1){var n=r[t];"country"==n.suptype&&e.params.push({id:n.id,country:!0,desc:n.direction+", "+n.distance+" км от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)?+n.land_area+" сот., ":"",housearea:parseFloat(n.house_area)?""+n.house_area+" м²":"",old_price:o(parseInt(n.old_price)),new_price:o(parseInt(n.new_price)),img:n.photo,link:n.link}),e.AbsentEmployees.employees=r,s.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,n){e[r]&&(t[n]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),n=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(n[e])}}}):4==e.currentTab&&e.loadedTabs.indexOf(4)===-1&&r.get("http://www.kre.ru/landing/sale/?suptype=commercial").success(function(r){e.loadedTabs.push(4),r.sort(a);for(var t=0;t<r.length;t+=1){var n=r[t];"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.metro+", "+n.distance,head:n.address||n.name,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:o(parseInt(n.old_price/1)),new_price:o(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.AbsentEmployees.employees=r,s.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,n){e[r]&&(t[n]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),n=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(n[e])}}})}e.AbsentEmployees={},e.callbackFormData={},e.signFormData={},e.orderFormData={},e.subFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isSignFormSended=!1,e.issubFormSended=!1,e.isOrderFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2,e.loadedTabs=[];var c=window.location.hash.split("/");c[1]||(c[1]="city"),c[1]||(c[1]="country"),c[1]||(c[1]="commerc"),"city"===c[1]&&(e.currentTab=2),"country"===c[1]&&(e.currentTab=3),"commerc"===c[1]&&(e.currentTab=4),e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"http://www.kre.ru/landing/callme/",data:t(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var t in e.callbackFormData)e.callbackFormData[t]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3)}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-gratitude-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Подписка на Discount",r({method:"POST",url:"http://www.kre.ru/landing/callme/",data:t(e.signFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.signForm.$setPristine();for(var t in e.signFormData)e.signFormData[t]="";e.isSignFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)})),console.log(e.signForm)},e.sendOrderForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"http://www.kre.ru/landing/callme/",data:t(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-request").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var t in e.orderFormData)e.orderFormData[t]="";e.isOrderFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3)}))},e.sendSubForm=function(){e.subForm.$valid&&(e.subFormData.subject="Подписка на Discount",r({method:"POST",url:"http://www.kre.ru/landing/callme/",data:t(e.subFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-sign").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3),e.subForm.$setPristine();for(var t in e.subFormData)e.subFormData[t]="";e.issubFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)}))},e.$watch("currentTab",function(){i()}),e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()};var s=e.AbsentEmployees;s.dataLoaded=!1}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,t){e.$last&&e.$eval(t.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsIiRjYWNoZUZhY3RvcnkiLCJhZGRTcGFjZXMiLCJuIiwicngiLCJTdHJpbmciLCJyZXBsYWNlIiwidyIsInRlc3QiLCJzb3J0Iiwib2JqMSIsIm9iajIiLCJkaXNjb3VudCIsImdldEpzb24iLCJjdXJyZW50VGFiIiwibG9hZGVkVGFicyIsImluZGV4T2YiLCJnZXQiLCJzdWNjZXNzIiwicHVzaCIsImkiLCJsZW5ndGgiLCJjdXJyZW50RmxhdCIsInN1cHR5cGUiLCJwYXJhbXMiLCJpZCIsImNpdHkiLCJyb29tcyIsInBhcnNlSW50IiwiZGVjb3JhdGlvbiIsImZsb29yIiwiaGVhZCIsImVzdGF0ZSIsInBhcnNlRmxvYXQiLCJzcXVhcmUiLCJhcmVhIiwib2xkX3ByaWNlIiwibmV3X3ByaWNlIiwiaW1nIiwicGhvdG8iLCJsaW5rIiwiQWJzZW50RW1wbG95ZWVzIiwiZW1wbG95ZWVzIiwiYWJFbXBsb3llZXMiLCJkYXRhTG9hZGVkIiwiZmlsdGVyIiwiaXRlbXMiLCJyZXN1bHQiLCJmb3JFYWNoIiwia2V5IiwiY3VycmVudCIsImNlbnRlciIsImJsb2NrcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1zIiwiY2hpbGRyZW4iLCJpbnNlcnRBZnRlciIsImNvdW50cnkiLCJkZXNjIiwiZGlyZWN0aW9uIiwiZGlzdGFuY2UiLCJob3VzZWFyZWEiLCJjb21tZXJjZSIsIm1ldHJvIiwiYWRkcmVzcyIsIm5hbWUiLCJjYWxsYmFja0Zvcm1EYXRhIiwic2lnbkZvcm1EYXRhIiwib3JkZXJGb3JtRGF0YSIsInN1YkZvcm1EYXRhIiwiYmFya2xpQnJva2VyRm9ybURhdGEiLCJpc0NhbGxiYWNrRm9ybVNlbmRlZCIsImlzU2lnbkZvcm1TZW5kZWQiLCJpc3N1YkZvcm1TZW5kZWQiLCJpc09yZGVyRm9ybVNlbmRlZCIsImlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCIsImxvY2F0aW9uIiwid2luZG93IiwiaGFzaCIsInNwbGl0IiwiY29tbWVyYyIsInNob3dDYWxsYmFja1BvcHVwIiwic2VuZENhbGxiYWNrRm9ybSIsImNhbGxiYWNrRm9ybSIsIiR2YWxpZCIsIm1ldGhvZCIsInVybCIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCIkc2V0UHJpc3RpbmUiLCJwcm9wIiwic2V0VGltZW91dCIsInNob3dTaWduUG9wdXAiLCJzZW5kU2lnbkZvcm0iLCJzaWduRm9ybSIsImNvbnNvbGUiLCJsb2ciLCJzZW5kT3JkZXJGb3JtIiwib3JkZXJGb3JtIiwic2VuZFN1YkZvcm0iLCJzdWJGb3JtIiwiJHdhdGNoIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsIiRsYXN0IiwiJGV2YWwiLCJyZXBlYXRFbmQiLCJFbGVtZW50IiwiZWxlbSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJuZXh0U2libGluZyIsInNjcm9sbCIsInNjcm9sbFRvcCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiXSwibWFwcGluZ3MiOiJDQUdBLFdBQ0ksWUFFQUEsR0FBRSxrQkFBa0JDLEdBQUcsUUFBUyxXQUM1QkQsRUFBRUUsTUFBTUMsU0FBU0MsWUFBWSxXQUdqQ0osRUFBRSxpQkFBaUJDLEdBQUcsVUFBVyxXQUM3QkQsRUFBRUUsTUFBTUcsTUFBTUMsS0FBTSxP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LEVBQU1HLGVBS2xDQyxRQUFRMUgsVUFBVW9FLFlBQWMsU0FBU3VELEdBQ3JDLE1BQU83SSxNQUFLOEksV0FBV0MsYUFBYUYsRUFBTTdJLEtBQUtnSixpQkFNdkRsSixFQUFFNkcsUUFBUXNDLE9BQU8sV0FDYm5KLEVBQUVFLE1BQU1rSixZQUFjLEtBQ3hCcEosRUFBRSxpQkFBaUJxSixTQUFTLFVBQzVCckosRUFBRSxpQkFBaUJzSixZQUFZLFlBRS9CdEosRUFBRSxpQkFBaUJzSixZQUFZLFVBQy9CdEosRUFBRSxpQkFBaUJxSixTQUFTIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBsdXpoaW4uZG0gb24gMTEuMDcuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAkKCcuai1wb3B1cC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotaW5wdXQtdGltZScpLm9uKCdmb2N1c2luJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5hdHRyKHt0eXBlOiAndGltZScsIHZhbHVlOiAnMTI6MDAnfSk7XHJcbiAgICB9KS5vbignZm9jdXNvdXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoJ3R5cGUnLCAndGV4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotcGhvbmUtbWFza2VkJykub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmICgkLmluQXJyYXkoZS5rZXlDb2RlLCBbNDYsIDgsIDksIDI3LCAxMywgMTEwLCAxOTBdKSAhPT0gLTEgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA9PSA2NSAmJiAoIGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUgKSApIHx8XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDQwKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoZS5zaGlmdEtleSB8fCAoZS5rZXlDb2RlIDwgNDggfHwgZS5rZXlDb2RlID4gNTcpKSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA3KSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAkKCcuai1zY3JvbGx0by1saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAkLnNjcm9sbFRvKFxyXG4gICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3Njcm9sbHRvLWJsb2NrJyksXHJcbiAgICAgICAgICAgIHtkdXJhdGlvbjogNTAwfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG59KSgpO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbi5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtYWluJywgW10pO1xyXG5cclxuICAgIGFwcC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRjYWNoZUZhY3RvcnknLCAnJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSwgJGNhY2hlRmFjdG9yeSkge1xyXG4gICAgICAgICRzY29wZS5BYnNlbnRFbXBsb3llZXMgPSB7fTtcclxuICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5zaWduRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5zdWJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmlzc3ViRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc09yZGVyRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc0JhcmtsaUJyb2tlckZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuY3VycmVudFRhYiA9IDI7XHJcbiAgICAgICAgJHNjb3BlLmxvYWRlZFRhYnMgPSBbXTtcclxuICAgICAgICB2YXIgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zcGxpdCgnLycpO1xyXG4gICAgICAgIGlmICghbG9jYXRpb25bMV0pIGxvY2F0aW9uWzFdID0gJ2NpdHknO1xyXG4gICAgICAgIGlmICghbG9jYXRpb25bMV0pIGxvY2F0aW9uWzFdID0gJ2NvdW50cnknO1xyXG4gICAgICAgIGlmICghbG9jYXRpb25bMV0pIGxvY2F0aW9uWzFdID0gJ2NvbW1lcmMnO1xyXG4gICAgICAgIGlmIChsb2NhdGlvblsxXSA9PT0gJ2NpdHknKSAkc2NvcGUuY3VycmVudFRhYiA9IDI7XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uWzFdID09PSAnY291bnRyeScpICRzY29wZS5jdXJyZW50VGFiID0gMztcclxuICAgICAgICBpZiAobG9jYXRpb25bMV0gPT09ICdjb21tZXJjJykgJHNjb3BlLmN1cnJlbnRUYWIgPSA0O1xyXG4gICAgICAgICRzY29wZS5wYXJhbXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuY291bnRyeSA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb21tZXJjID0gW107XHJcblxyXG5cclxuXHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBTVEFSVCovXHJcblxyXG4gICAgICAgICRzY29wZS5zaG93Q2FsbGJhY2tQb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkKSAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kQ2FsbGJhY2tGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2FsbGJhY2tGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6LiDQodC60LjQtNC60LguJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vd3d3LmtyZS5ydS9sYW5kaW5nL2NhbGxtZS8nLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKkNBTExCQUNLIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBTVEFSVCovXHJcbiAgICAgICAgJHNjb3BlLnNob3dTaWduUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkKSAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRTaWduRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNpZ25Gb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpZ25Gb3JtRGF0YVsnc3ViamVjdCddID0gJ9Cf0L7QtNC/0LjRgdC60LAg0L3QsCBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL3d3dy5rcmUucnUvbGFuZGluZy9jYWxsbWUvJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuc2lnbkZvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpZ25Gb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLnNpZ25Gb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnNpZ25Gb3JtKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlJFUVVFU1QgRk9STSBTRU5ESU5HIFNUQVJUKi9cclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRPcmRlckZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5vcmRlckZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YVsnc3ViamVjdCddID0gJ9CX0LDQutCw0LfQsNGC0Ywg0L7QsdGA0LDRgtC90YvQuSDQt9Cy0L7QvdC+0LouINCh0LrQuNC00LrQuC4nO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly93d3cua3JlLnJ1L2xhbmRpbmcvY2FsbG1lLycsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLm9yZGVyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtcmVxdWVzdCcpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXJlcXVlc3QnKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLm9yZGVyRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzT3JkZXJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtcmVxdWVzdCcpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZFN1YkZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zdWJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1YkZvcm1EYXRhWydzdWJqZWN0J10gPSAn0J/QvtC00L/QuNGB0LrQsCDQvdCwIERpc2NvdW50JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vd3d3LmtyZS5ydS9sYW5kaW5nL2NhbGxtZS8nLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5zdWJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1zaWduJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLnN1YkZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zdWJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNzdWJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdjdXJyZW50VGFiJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGdldEpzb24oKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS5zaG93U2lnblBvcHVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCkgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBhZGRTcGFjZXMobikge1xyXG4gICAgICAgICAgICB2YXIgcnggPSAvKFxcZCspKFxcZHszfSkvO1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKG4pXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXlxcZCsvLCBmdW5jdGlvbiAodykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyeC50ZXN0KHcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB3LnJlcGxhY2UocngsICckMSAkMicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdztcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzb3J0KG9iajEsIG9iajIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9iajIuZGlzY291bnQgLSBvYmoxLmRpc2NvdW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFiRW1wbG95ZWVzID0gJHNjb3BlLkFic2VudEVtcGxveWVlcztcclxuICAgICAgICBhYkVtcGxveWVlcy5kYXRhTG9hZGVkID0gZmFsc2U7XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRKc29uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmN1cnJlbnRUYWIgPT0gMiAmJiAkc2NvcGUubG9hZGVkVGFicy5pbmRleE9mKDIpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCdodHRwOi8vd3d3LmtyZS5ydS9sYW5kaW5nL3NhbGUvP3N1cHR5cGU9Y2l0eScpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkZWRUYWJzLnB1c2goMik7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmxhdCA9IGRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudEZsYXQuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tczogKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSk/IChwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkrJyAtINC60L7QvC4g0LrQsi4sICcpIDogJyAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY29yYXRpb246IGN1cnJlbnRGbGF0LmRlY29yYXRpb24gfHwgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3I6IChwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikpPyAnLCAnKyhwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikgKyAnLdC5INGN0YLQsNC2JykgOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBjdXJyZW50RmxhdC5saW5rXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuQWJzZW50RW1wbG95ZWVzLmVtcGxveWVlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFiRW1wbG95ZWVzLmRhdGFMb2FkZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVbYXR0cl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZGlzY291bnRfaW5uZXInKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWZvcm0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKSUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aCAvIDIpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja3NbY3VycmVudF0uY2hpbGRyZW5bY2VudGVyLTFdLmluc2VydEFmdGVyKGZvcm1zW2N1cnJlbnRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5jdXJyZW50VGFiID09IDMgJiYgJHNjb3BlLmxvYWRlZFRhYnMuaW5kZXhPZigzKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnaHR0cDovL3d3dy5rcmUucnUvbGFuZGluZy9zYWxlLz9zdXB0eXBlPWNvdW50cnknKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGVkVGFicy5wdXNoKDMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc29ydChzb3J0KTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZsYXQgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY291bnRyeScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQuZGlyZWN0aW9uICsgJywgJyArIGN1cnJlbnRGbGF0LmRpc3RhbmNlKycg0LrQvCDQvtGCINCc0JrQkNCUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY291bnQ6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuZGlzY291bnQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogKHBhcnNlRmxvYXQoY3VycmVudEZsYXRbJ2xhbmRfYXJlYSddKSk/ICtjdXJyZW50RmxhdFsnbGFuZF9hcmVhJ10rJyDRgdC+0YIuLCAnOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZWFyZWE6IChwYXJzZUZsb2F0KGN1cnJlbnRGbGF0Wydob3VzZV9hcmVhJ10pKT8gJycrY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSsnINC8wrInOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5BYnNlbnRFbXBsb3llZXMuZW1wbG95ZWVzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWJFbXBsb3llZXMuZGF0YUxvYWRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oaXRlbXMsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVthdHRyXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1kaXNjb3VudF9pbm5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZm9ybScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpJTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbltjZW50ZXItMV0uaW5zZXJ0QWZ0ZXIoZm9ybXNbY3VycmVudF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmN1cnJlbnRUYWIgPT0gNCAmJiAkc2NvcGUubG9hZGVkVGFicy5pbmRleE9mKDQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCdodHRwOi8vd3d3LmtyZS5ydS9sYW5kaW5nL3NhbGUvP3N1cHR5cGU9Y29tbWVyY2lhbCcpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkZWRUYWJzLnB1c2goNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RmxhdCA9IGRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb21tZXJjZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lcmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGN1cnJlbnRGbGF0Lm1ldHJvKyAnLCAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuYWRkcmVzcyB8fCBjdXJyZW50RmxhdC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IHBhcnNlRmxvYXQoY3VycmVudEZsYXQuYXJlYSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFic2VudEVtcGxveWVlcy5lbXBsb3llZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhYkVtcGxveWVlcy5kYXRhTG9hZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbihpdGVtcywgYXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlW2F0dHJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWRpc2NvdW50X2lubmVyJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1mb3JtJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGggLyAyKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3Jtc1tjdXJyZW50XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1dKTtcclxuICAgIGFwcC5kaXJlY3RpdmUoXCJyZXBlYXRFbmRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMucmVwZWF0RW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFmdGVyID0gZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

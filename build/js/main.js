!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$cacheFactory","$httpParamSerializerJQLike",function(e,r,t,o){function n(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function a(e,r){return r.discount-e.discount}e.AbsentEmployees={},e.callbackFormData={},e.signFormData={},e.orderFormData={},e.subFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isSignFormSended=!1,e.issubFormSended=!1,e.isOrderFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2;var i=window.location.hash.split("/");i[1]||(i[1]="city"),i[1]||(i[1]="country"),i[1]||(i[1]="commerc"),"city"===i[1]&&(e.currentTab=2),"country"===i[1]&&(e.currentTab=3),"commerc"===i[1]&&(e.currentTab=4),e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"/sendmail.php",data:t(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var t in e.callbackFormData)e.callbackFormData[t]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3)}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-gratitude-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Подписка на Discount",r({method:"POST",url:"/sendmail.php",data:t(e.signFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.signForm.$setPristine();for(var t in e.signFormData)e.signFormData[t]="";e.isSignFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)})),console.log(e.signForm)},e.sendOrderForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Заказать обратный звонок. Скидки.",r({method:"POST",url:"/sendmail.php",data:t(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-request").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var t in e.orderFormData)e.orderFormData[t]="";e.isOrderFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3)}))},e.sendSubForm=function(){e.subForm.$valid&&(e.subFormData.subject="Подписка на Discount",r({method:"POST",url:"/sendmail.php",data:t(e.subFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-sign").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3),e.subForm.$setPristine();for(var t in e.subFormData)e.subFormData[t]="";e.issubFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-sign").arcticmodal("close")},3e3)}))},2==e.currentTab?r.get("city.json").success(function(r){console.log("get"),r.sort(a);for(var t=0;t<r.length;t+=1){var o=r[t];"city"==o.suptype&&e.params.push({id:o.id,city:!0,rooms:parseInt(o.nb_rooms)?parseInt(o.nb_rooms)+" - ком. кв., ":" ",decoration:o.decoration||"",floor:parseInt(o.floor)?", "+(parseInt(o.floor)+"-й этаж"):"",head:o.estate,discount:parseFloat(o.discount),square:parseFloat(o.area),old_price:n(parseInt(o.old_price/1)),new_price:n(parseInt(o.new_price/1)),img:o.photo,link:o.link}),e.AbsentEmployees.employees=r,c.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,o){e[r]&&(t[o]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(o[e])}}}):3==e.currentTab?r.get("country.json").success(function(r){r.sort(a);for(var t=0;t<r.length;t+=1){var o=r[t];"country"==o.suptype&&e.params.push({id:o.id,country:!0,desc:o.direction+", "+o.distance+" км от МКАД",head:o.estate,discount:parseFloat(o.discount),square:parseFloat(o.land_area)?+o.land_area+" сот., ":"",housearea:parseFloat(o.house_area)?""+o.house_area+" м²":"",old_price:n(parseInt(o.old_price)),new_price:n(parseInt(o.new_price)),img:o.photo,link:o.link}),e.AbsentEmployees.employees=r,c.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,o){e[r]&&(t[o]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(o[e])}}}):4==e.currentTab&&r.get("commerc.json").success(function(r){r.sort(a);for(var t=0;t<r.length;t+=1){var o=r[t];"commerce"==o.suptype&&e.params.push({id:o.id,commerce:!0,desc:o.metro+", "+o.distance,head:o.address||o.name,discount:parseFloat(o.discount),square:parseFloat(o.area),old_price:n(parseInt(o.old_price/1)),new_price:n(parseInt(o.new_price/1)),img:o.photo,link:o.link}),e.AbsentEmployees.employees=r,c.dataLoaded=!0,e.filter=function(e,r){var t={};return angular.forEach(e,function(e,o){e[r]&&(t[o]=e)}),t},e.test=function(e){var r=0,t=document.querySelectorAll(".b-discount_inner"),o=document.querySelectorAll(".b-form");r=parseInt(t[e].children.length/2)%2?parseInt(t[e].children.length/2)+1:parseInt(t[e].children.length/2),t[e].children[r-1].insertAfter(o[e])}}}),e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()};var c=e.AbsentEmployees;c.dataLoaded=!1}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,t){e.$last&&e.$eval(t.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsIiRjYWNoZUZhY3RvcnkiLCJhZGRTcGFjZXMiLCJuIiwicngiLCJTdHJpbmciLCJyZXBsYWNlIiwidyIsInRlc3QiLCJzb3J0Iiwib2JqMSIsIm9iajIiLCJkaXNjb3VudCIsIkFic2VudEVtcGxveWVlcyIsImNhbGxiYWNrRm9ybURhdGEiLCJzaWduRm9ybURhdGEiLCJvcmRlckZvcm1EYXRhIiwic3ViRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNTaWduRm9ybVNlbmRlZCIsImlzc3ViRm9ybVNlbmRlZCIsImlzT3JkZXJGb3JtU2VuZGVkIiwiaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkIiwiY3VycmVudFRhYiIsImxvY2F0aW9uIiwid2luZG93IiwiaGFzaCIsInNwbGl0IiwicGFyYW1zIiwiY291bnRyeSIsImNvbW1lcmMiLCJzaG93Q2FsbGJhY2tQb3B1cCIsInNlbmRDYWxsYmFja0Zvcm0iLCJjYWxsYmFja0Zvcm0iLCIkdmFsaWQiLCJtZXRob2QiLCJ1cmwiLCJoZWFkZXJzIiwiQ29udGVudC1UeXBlIiwic3VjY2VzcyIsIiRzZXRQcmlzdGluZSIsInByb3AiLCJzZXRUaW1lb3V0Iiwic2hvd1NpZ25Qb3B1cCIsInNlbmRTaWduRm9ybSIsInNpZ25Gb3JtIiwiY29uc29sZSIsImxvZyIsInNlbmRPcmRlckZvcm0iLCJvcmRlckZvcm0iLCJzZW5kU3ViRm9ybSIsInN1YkZvcm0iLCJnZXQiLCJpIiwibGVuZ3RoIiwiY3VycmVudEZsYXQiLCJzdXB0eXBlIiwicHVzaCIsImlkIiwiY2l0eSIsInJvb21zIiwicGFyc2VJbnQiLCJkZWNvcmF0aW9uIiwiZmxvb3IiLCJoZWFkIiwiZXN0YXRlIiwicGFyc2VGbG9hdCIsInNxdWFyZSIsImFyZWEiLCJvbGRfcHJpY2UiLCJuZXdfcHJpY2UiLCJpbWciLCJwaG90byIsImxpbmsiLCJlbXBsb3llZXMiLCJhYkVtcGxveWVlcyIsImRhdGFMb2FkZWQiLCJmaWx0ZXIiLCJpdGVtcyIsInJlc3VsdCIsImZvckVhY2giLCJrZXkiLCJjdXJyZW50IiwiY2VudGVyIiwiYmxvY2tzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9ybXMiLCJjaGlsZHJlbiIsImluc2VydEFmdGVyIiwiZGVzYyIsImRpcmVjdGlvbiIsImRpc3RhbmNlIiwiaG91c2VhcmVhIiwiY29tbWVyY2UiLCJtZXRybyIsImFkZHJlc3MiLCJuYW1lIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsIiRsYXN0IiwiJGV2YWwiLCJyZXBlYXRFbmQiLCJFbGVtZW50IiwiZWxlbSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJuZXh0U2libGluZyIsInNjcm9sbCIsInNjcm9sbFRvcCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiXSwibWFwcGluZ3MiOiJDQUdBLFdBQ0ksWUFFQUEsR0FBRSxrQkFBa0JDLEdBQUcsUUFBUyxXQUM1QkQsRUFBRUUsTUFBTUMsU0FBU0MsWUFBWSxXQUdqQ0osRUFBRSxpQkFBaUJDLEdBQUcsVUFBVyxXQUM3QkQsRUFBRUUsTUFBTUcsTUFBTUMsS0FBTSxPQUFRQyxNQUFPLFlBQ3BDTixHQUFHLFdBQVksV0FDZEQsRUFBRUUsTUFBTUcsS0FBSyxPQUFRLFVBR3pCTCxFQUFFLG1CQUFtQkMsR0FBRyxVQUFXLFNBQVVPLEdBQ3JDUixFQUFFUyxRQUFRRCxFQUFFRSxTQUFVLEdBQUksRUFBRyxFQUFHLEdBQUksR0FBSSxJQUFLLFlBQy9CLElBQWJGLEVBQUVFLFVBQW1CRixFQUFFRyxXQUFZLEdBQVFILEVBQUVJLFdBQVksSUFDekRKLEVBQUVFLFNBQVcsSUFBTUYsRUFBRUUsU0FBVyxLQUdoQ0YsRUFBRUssVUFBYUwsRUFBRUUsUUFBVSxJQUFNRixFQUFFRSxRQUFVLE1BQVNGLEVBQUVFLFFBQVUsSUFBTUYsRUFBRUUsUUFBVSxNQUNyRkYsRUFBRU0sbUJBR1ZkLEVBQUUsb0JBQW9CQyxHQUFHLFFBQVMsU0FBU2MsR0FLdkMsTUFKQWYsR0FBRWdCLFNBQ0VoQixFQUFFRSxNQUFNZSxLQUFLLG1CQUNaQyxTQUFVLE9BRVIsT0FJZixXQUNJLFlBRUFDLE9BQU1DLFVBQVVDLElBQU0sV0FDbEIsTUFBT0MsTUFBS0QsSUFBSUUsTUFBTSxLQUFNckIsT0FHaENpQixNQUFNQyxVQUFVSSxJQUFNLFdBQ2xCLE1BQU9GLE1BQUtFLElBQUlELE1BQU0sS0FBTXJCLE1BR2hDLElBQUl1QixHQUFNQyxRQUFRQyxPQUFPLFVBRXpCRixHQUFJRyxXQUFXLGtCQUFtQixTQUFVLFFBQVMsZ0JBQWlCLDZCQUE4QixTQUFTQyxFQUFRQyxFQUFPQyxFQUE0QkMsR0E4UnBKLFFBQVNDLEdBQVVDLEdBQ2YsR0FBSUMsR0FBSyxjQUNULE9BQU9DLFFBQU9GLEdBQ1RHLFFBQVEsT0FBUSxTQUFVQyxHQUN2QixLQUFPSCxFQUFHSSxLQUFLRCxJQUNYQSxFQUFJQSxFQUFFRCxRQUFRRixFQUFJLFFBRXRCLE9BQU9HLEtBR25CLFFBQVNFLEdBQUtDLEVBQU1DLEdBQ2hCLE1BQU9BLEdBQUtDLFNBQVdGLEVBQUtFLFNBeFNoQ2QsRUFBT2UsbUJBQ1BmLEVBQU9nQixvQkFDUGhCLEVBQU9pQixnQkFDUGpCLEVBQU9rQixpQkFDUGxCLEVBQU9tQixlQUNQbkIsRUFBT29CLHdCQUNQcEIsRUFBT3FCLHNCQUF1QixFQUM5QnJCLEVBQU9zQixrQkFBbUIsRUFDMUJ0QixFQUFPdUIsaUJBQWtCLEVBQ3pCdkIsRUFBT3dCLG1CQUFvQixFQUMzQnhCLEVBQU95QiwwQkFBMkIsRUFJbEN6QixFQUFPMEIsV0FBYSxDQUNwQixJQUFJQyxHQUFXQyxPQUFPRCxTQUFTRSxLQUFLQyxNQUFNLElBQ3JDSCxHQUFTLEtBQUlBLEVBQVMsR0FBSyxRQUMzQkEsRUFBUyxLQUFJQSxFQUFTLEdBQUssV0FDM0JBLEVBQVMsS0FBSUEsRUFBUyxHQUFLLFdBQ1osU0FBaEJBLEVBQVMsS0FBZTNCLEVBQU8wQixXQUFhLEdBQzVCLFlBQWhCQyxFQUFTLEtBQWtCM0IsRUFBTzBCLFdBQWEsR0FDL0IsWUFBaEJDLEVBQVMsS0FBa0IzQixFQUFPMEIsV0FBYSxHQUNuRDFCLEVBQU8rQixVQUNQL0IsRUFBT2dDLFdBQ1BoQyxFQUFPaUMsV0FJUGpDLEVBQU9rQyxrQkFBb0IsV0FDbkJsQyxFQUFPcUIsdUJBQXNCckIsRUFBT3FCLHNCQUF1QixHQUMvRGxELEVBQUUscUJBQXFCSSxlQUczQnlCLEVBQU9tQyxpQkFBbUIsV0FDbEJuQyxFQUFPb0MsYUFBYUMsU0FDcEJyQyxFQUFPZ0IsaUJBQTBCLFFBQUksb0NBQ3JDZixHQUNJcUMsT0FBUSxPQUNSQyxJQUFLLGdCQUNMbkQsS0FBTWMsRUFBMkJGLEVBQU9nQixrQkFDeEN3QixTQUFVQyxlQUFnQix1Q0FDM0JDLFFBQVEsU0FBU3RELEdBQ2hCWSxFQUFPb0MsYUFBYU8sY0FDcEIsS0FBSyxHQUFJQyxLQUFRNUMsR0FBT2dCLGlCQUNwQmhCLEVBQU9nQixpQkFBaUI0QixHQUFRLEVBRXBDNUMsR0FBT3FCLHNCQUF1QixFQUM5QndCLFdBQVcsV0FDUDFFLEVBQUUscUJBQXFCSSxZQUFZLFVBQ3BDLFNBT2Z5QixFQUFPOEMsY0FBZ0IsV0FDZjlDLEVBQU9zQixtQkFBa0J0QixFQUFPc0Isa0JBQW1CLEdBQ3ZEbkQsRUFBRSwyQkFBMkJJLGVBR2pDeUIsRUFBTytDLGFBQWUsV0FDZC9DLEVBQU9nRCxTQUFTWCxTQUNoQnJDLEVBQU9pQixhQUFzQixRQUFJLHVCQUNqQ2hCLEdBQ0lxQyxPQUFRLE9BQ1JDLElBQUssZ0JBQ0xuRCxLQUFNYyxFQUEyQkYsRUFBT2lCLGNBQ3hDdUIsU0FBVUMsZUFBZ0IsdUNBQzNCQyxRQUFRLFNBQVN0RCxHQUNoQlksRUFBT2dELFNBQVNMLGNBQ2hCLEtBQUssR0FBSUMsS0FBUTVDLEdBQU9pQixhQUNwQmpCLEVBQU9pQixhQUFhMkIsR0FBUSxFQUVoQzVDLEdBQU9zQixrQkFBbUIsRUFDMUJ1QixXQUFXLFdBQ1AxRSxFQUFFLDJCQUEyQkksWUFBWSxVQUMxQyxRQUdYMEUsUUFBUUMsSUFBSWxELEVBQU9nRCxXQU12QmhELEVBQU9tRCxjQUFnQixXQUNmbkQsRUFBT29ELFVBQVVmLFNBQ2pCckMsRUFBT2tCLGNBQXVCLFFBQUksb0NBQ2xDakIsR0FDSXFDLE9BQVEsT0FDUkMsSUFBSyxnQkFDTG5ELEtBQU1jLEVBQTJCRixFQUFPa0IsZUFDeENzQixTQUFVQyxlQUFnQix1Q0FDM0JDLFFBQVEsU0FBU3RELEdBQ2hCakIsRUFBRSw4QkFBOEJJLGNBQ2hDc0UsV0FBVyxXQUNQMUUsRUFBRSw4QkFBOEJJLFlBQVksVUFDN0MsS0FDSHlCLEVBQU9vRCxVQUFVVCxjQUNqQixLQUFLLEdBQUlDLEtBQVE1QyxHQUFPa0IsY0FDcEJsQixFQUFPa0IsY0FBYzBCLEdBQVEsRUFFakM1QyxHQUFPd0IsbUJBQW9CLEVBQzNCcUIsV0FBVyxXQUNQMUUsRUFBRSw4QkFBOEJJLFlBQVksVUFDN0MsU0FLZnlCLEVBQU9xRCxZQUFjLFdBQ2JyRCxFQUFPc0QsUUFBUWpCLFNBQ2ZyQyxFQUFPbUIsWUFBcUIsUUFBSSx1QkFDaENsQixHQUNJcUMsT0FBUSxPQUNSQyxJQUFLLGdCQUNMbkQsS0FBTWMsRUFBMkJGLEVBQU9tQixhQUN4Q3FCLFNBQVVDLGVBQWdCLHVDQUMzQkMsUUFBUSxTQUFTdEQsR0FDaEJqQixFQUFFLDJCQUEyQkksY0FDN0JzRSxXQUFXLFdBQ1AxRSxFQUFFLDJCQUEyQkksWUFBWSxVQUMxQyxLQUNIeUIsRUFBT3NELFFBQVFYLGNBQ2YsS0FBSyxHQUFJQyxLQUFRNUMsR0FBT21CLFlBQ3BCbkIsRUFBT21CLFlBQVl5QixHQUFRLEVBRS9CNUMsR0FBT3VCLGlCQUFrQixFQUN6QnNCLFdBQVcsV0FDUDFFLEVBQUUsMkJBQTJCSSxZQUFZLFVBQzFDLFNBS1MsR0FBckJ5QixFQUFPMEIsV0FDTnpCLEVBQU1zRCxJQUFJLGFBQWFiLFFBQVEsU0FBU3RELEdBQ3BDNkQsUUFBUUMsSUFBSSxPQUNaOUQsRUFBS3VCLEtBQUtBLEVBQ1YsS0FBSSxHQUFJNkMsR0FBSSxFQUFHQSxFQUFJcEUsRUFBS3FFLE9BQVFELEdBQUssRUFBRyxDQUNwQyxHQUFJRSxHQUFjdEUsRUFBS29FLEVBQ0ksU0FBdkJFLEVBQVlDLFNBQ1ozRCxFQUFPK0IsT0FBTzZCLE1BQ1ZDLEdBQUlILEVBQVlHLEdBQ2hCQyxNQUFNLEVBQ05DLE1BQVFDLFNBQVNOLEVBQXNCLFVBQU1NLFNBQVNOLEVBQXNCLFVBQUcsZ0JBQW1CLElBQ2xHTyxXQUFZUCxFQUFZTyxZQUFjLEdBQ3RDQyxNQUFRRixTQUFTTixFQUFZUSxPQUFTLE1BQU1GLFNBQVNOLEVBQVlRLE9BQVMsV0FBYSxHQUN2RkMsS0FBTVQsRUFBWVUsT0FDbEJ0RCxTQUFVdUQsV0FBV1gsRUFBWTVDLFVBQ2pDd0QsT0FBUUQsV0FBV1gsRUFBWWEsTUFDL0JDLFVBQVdwRSxFQUFVNEQsU0FBU04sRUFBdUIsVUFBRSxJQUN2RGUsVUFBV3JFLEVBQVU0RCxTQUFTTixFQUF1QixVQUFFLElBQ3ZEZ0IsSUFBS2hCLEVBQVlpQixNQUNqQkMsS0FBTWxCLEVBQVlrQixPQUkxQjVFLEVBQU9lLGdCQUFnQjhELFVBQVl6RixFQUNuQzBGLEVBQVlDLFlBQWEsRUFFekIvRSxFQUFPZ0YsT0FBUyxTQUFTQyxFQUFPekcsR0FDNUIsR0FBSTBHLEtBTUosT0FMQXJGLFNBQVFzRixRQUFRRixFQUFPLFNBQVN2RyxFQUFPMEcsR0FDL0IxRyxFQUFNRixLQUNOMEcsRUFBT0UsR0FBTzFHLEtBR2Z3RyxHQUVYbEYsRUFBT1UsS0FBTyxTQUFTMkUsR0FDbkIsR0FBSUMsR0FBUyxFQUNUQyxFQUFTQyxTQUFTQyxpQkFBaUIscUJBQ25DQyxFQUFRRixTQUFTQyxpQkFBaUIsVUFHbENILEdBREF0QixTQUFTdUIsRUFBT0YsR0FBU00sU0FBU2xDLE9BQU8sR0FBRyxFQUNuQ08sU0FBU3VCLEVBQU9GLEdBQVNNLFNBQVNsQyxPQUFTLEdBQUssRUFHaERPLFNBQVN1QixFQUFPRixHQUFTTSxTQUFTbEMsT0FBTyxHQUV0RDhCLEVBQU9GLEdBQVNNLFNBQVNMLEVBQU8sR0FBR00sWUFBWUYsRUFBTUwsUUFJckMsR0FBckJyRixFQUFPMEIsV0FDZHpCLEVBQU1zRCxJQUFJLGdCQUFnQmIsUUFBUSxTQUFTdEQsR0FDdkNBLEVBQUt1QixLQUFLQSxFQUNWLEtBQUksR0FBSTZDLEdBQUksRUFBR0EsRUFBSXBFLEVBQUtxRSxPQUFRRCxHQUFLLEVBQUcsQ0FDcEMsR0FBSUUsR0FBY3RFLEVBQUtvRSxFQUNJLFlBQXZCRSxFQUFZQyxTQUNaM0QsRUFBTytCLE9BQU82QixNQUNWQyxHQUFJSCxFQUFZRyxHQUNoQjdCLFNBQVMsRUFDVDZELEtBQU1uQyxFQUFZb0MsVUFBWSxLQUFPcEMsRUFBWXFDLFNBQVMsY0FDMUQ1QixLQUFNVCxFQUFZVSxPQUNsQnRELFNBQVV1RCxXQUFXWCxFQUFZNUMsVUFDakN3RCxPQUFTRCxXQUFXWCxFQUF1QixZQUFNQSxFQUF1QixVQUFFLFVBQVcsR0FDckZzQyxVQUFZM0IsV0FBV1gsRUFBd0IsWUFBSyxHQUFHQSxFQUF3QixXQUFFLE1BQU8sR0FDeEZjLFVBQVdwRSxFQUFVNEQsU0FBU04sRUFBdUIsWUFDckRlLFVBQVdyRSxFQUFVNEQsU0FBU04sRUFBdUIsWUFDckRnQixJQUFLaEIsRUFBWWlCLE1BQ2pCQyxLQUFNbEIsRUFBWWtCLE9BRzFCNUUsRUFBT2UsZ0JBQWdCOEQsVUFBWXpGLEVBQ25DMEYsRUFBWUMsWUFBYSxFQUV6Qi9FLEVBQU9nRixPQUFTLFNBQVNDLEVBQU96RyxHQUM1QixHQUFJMEcsS0FNSixPQUxBckYsU0FBUXNGLFFBQVFGLEVBQU8sU0FBU3ZHLEVBQU8wRyxHQUMvQjFHLEVBQU1GLEtBQ04wRyxFQUFPRSxHQUFPMUcsS0FHZndHLEdBRVhsRixFQUFPVSxLQUFPLFNBQVMyRSxHQUNuQixHQUFJQyxHQUFTLEVBQ1RDLEVBQVNDLFNBQVNDLGlCQUFpQixxQkFDbkNDLEVBQVFGLFNBQVNDLGlCQUFpQixVQUdsQ0gsR0FEQXRCLFNBQVN1QixFQUFPRixHQUFTTSxTQUFTbEMsT0FBTyxHQUFHLEVBQ25DTyxTQUFTdUIsRUFBT0YsR0FBU00sU0FBU2xDLE9BQVMsR0FBSyxFQUdoRE8sU0FBU3VCLEVBQU9GLEdBQVNNLFNBQVNsQyxPQUFPLEdBRXREOEIsRUFBT0YsR0FBU00sU0FBU0wsRUFBTyxHQUFHTSxZQUFZRixFQUFNTCxRQUlyQyxHQUFyQnJGLEVBQU8wQixZQUNkekIsRUFBTXNELElBQUksZ0JBQWdCYixRQUFRLFNBQVN0RCxHQUN2Q0EsRUFBS3VCLEtBQUtBLEVBQ1YsS0FBSSxHQUFJNkMsR0FBSSxFQUFHQSxFQUFJcEUsRUFBS3FFLE9BQVFELEdBQUssRUFBRyxDQUNwQyxHQUFJRSxHQUFjdEUsRUFBS29FLEVBQ0EsYUFBdkJFLEVBQVlDLFNBQ1IzRCxFQUFPK0IsT0FBTzZCLE1BQ1ZDLEdBQUlILEVBQVlHLEdBQ2hCb0MsVUFBVSxFQUNWSixLQUFNbkMsRUFBWXdDLE1BQU8sS0FBT3hDLEVBQVlxQyxTQUM1QzVCLEtBQU1ULEVBQVl5QyxTQUFXekMsRUFBWTBDLEtBQ3pDdEYsU0FBVXVELFdBQVdYLEVBQVk1QyxVQUNqQ3dELE9BQVFELFdBQVdYLEVBQVlhLE1BQy9CQyxVQUFXcEUsRUFBVTRELFNBQVNOLEVBQXVCLFVBQUUsSUFDdkRlLFVBQVdyRSxFQUFVNEQsU0FBU04sRUFBdUIsVUFBRSxJQUN2RGdCLElBQUtoQixFQUFZaUIsTUFDakJDLEtBQU1sQixFQUFZa0IsT0FHMUI1RSxFQUFPZSxnQkFBZ0I4RCxVQUFZekYsRUFDbkMwRixFQUFZQyxZQUFhLEVBRXpCL0UsRUFBT2dGLE9BQVMsU0FBU0MsRUFBT3pHLEdBQzVCLEdBQUkwRyxLQU1KLE9BTEFyRixTQUFRc0YsUUFBUUYsRUFBTyxTQUFTdkcsRUFBTzBHLEdBQy9CMUcsRUFBTUYsS0FDTjBHLEVBQU9FLEdBQU8xRyxLQUdmd0csR0FFWGxGLEVBQU9VLEtBQU8sU0FBUzJFLEdBQ25CLEdBQUlDLEdBQVMsRUFDVEMsRUFBU0MsU0FBU0MsaUJBQWlCLHFCQUNuQ0MsRUFBUUYsU0FBU0MsaUJBQWlCLFVBR2xDSCxHQURBdEIsU0FBU3VCLEVBQU9GLEdBQVNNLFNBQVNsQyxPQUFPLEdBQUcsRUFDbkNPLFNBQVN1QixFQUFPRixHQUFTTSxTQUFTbEMsT0FBUyxHQUFLLEVBR2hETyxTQUFTdUIsRUFBT0YsR0FBU00sU0FBU2xDLE9BQU8sR0FFdEQ4QixFQUFPRixHQUFTTSxTQUFTTCxFQUFPLEdBQUdNLFlBQVlGLEVBQU1MLFFBTXJFckYsRUFBTzhDLGNBQWdCLFdBQ2Y5QyxFQUFPc0IsbUJBQWtCdEIsRUFBT3NCLGtCQUFtQixHQUN2RG5ELEVBQUUsaUJBQWlCSSxjQWdCdkIsSUFBSXVHLEdBQWM5RSxFQUFPZSxlQUN6QitELEdBQVlDLFlBQWEsS0FNN0JuRixFQUFJeUcsVUFBVSxZQUFhLFdBQ3ZCLE9BQ0lDLFNBQVUsSUFDVjFCLEtBQU0sU0FBVTJCLEVBQU9DLEVBQVNDLEdBQ3hCRixFQUFNRyxPQUNOSCxFQUFNSSxNQUFNRixFQUFNRyxlQUtsQ0MsUUFBUXRILFVBQVVxRyxZQUFjLFNBQVNrQixHQUNyQyxNQUFPekksTUFBSzBJLFdBQVdDLGFBQWFGLEVBQU16SSxLQUFLNEksaUJBTXZEOUksRUFBRXlELFFBQVFzRixPQUFPLFdBQ2IvSSxFQUFFRSxNQUFNOEksWUFBYyxLQUN4QmhKLEVBQUUsaUJBQWlCaUosU0FBUyxVQUM1QmpKLEVBQUUsaUJBQWlCa0osWUFBWSxZQUUvQmxKLEVBQUUsaUJBQWlCa0osWUFBWSxVQUMvQmxKLEVBQUUsaUJBQWlCaUosU0FBUyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgJCgnLmotcG9wdXAtY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5qLWlucHV0LXRpbWUnKS5vbignZm9jdXNpbicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICQodGhpcykuYXR0cih7dHlwZTogJ3RpbWUnLCB2YWx1ZTogJzEyOjAwJ30pO1xyXG4gICAgfSkub24oJ2ZvY3Vzb3V0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoJy5qLXBob25lLW1hc2tlZCcpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoJC5pbkFycmF5KGUua2V5Q29kZSwgWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXSkgIT09IC0xIHx8XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPT0gNjUgJiYgKCBlLmN0cmxLZXkgPT09IHRydWUgfHwgZS5tZXRhS2V5ID09PSB0cnVlICkgKSB8fFxyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID49IDM1ICYmIGUua2V5Q29kZSA8PSA0MCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKGUuc2hpZnRLZXkgfHwgKGUua2V5Q29kZSA8IDQ4IHx8IGUua2V5Q29kZSA+IDU3KSkgJiYgKGUua2V5Q29kZSA8IDk2IHx8IGUua2V5Q29kZSA+IDEwNykpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgJCgnLmotc2Nyb2xsdG8tbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgJC5zY3JvbGxUbyhcclxuICAgICAgICAgICAgJCh0aGlzKS5kYXRhKCdzY3JvbGx0by1ibG9jaycpLFxyXG4gICAgICAgICAgICB7ZHVyYXRpb246IDUwMH1cclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG5cclxufSkoKTtcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIEFycmF5LnByb3RvdHlwZS5tYXggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgdGhpcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIEFycmF5LnByb3RvdHlwZS5taW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5taW4uYXBwbHkobnVsbCwgdGhpcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbWFpbicsIFtdKTtcclxuXHJcbiAgICBhcHAuY29udHJvbGxlcignbWFpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckY2FjaGVGYWN0b3J5JywgJyRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UsICRjYWNoZUZhY3RvcnkpIHtcclxuICAgICAgICAkc2NvcGUuQWJzZW50RW1wbG95ZWVzID0ge307XHJcbiAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuc2lnbkZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuc3ViRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc3N1YkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNPcmRlckZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgLyokc2NvcGUuc2hvd0NpdHlUeXBlID0ge307XHJcbiAgICAgICAgJHNjb3BlLnNob3dDb3V0cnlUeXBlID0ge307XHJcbiAgICAgICAgJHNjb3BlLnNob3dDb21tZXJjVHlwZSA9IHt9OyovXHJcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRUYWIgPSAyO1xyXG4gICAgICAgIHZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgaWYgKCFsb2NhdGlvblsxXSkgbG9jYXRpb25bMV0gPSAnY2l0eSc7XHJcbiAgICAgICAgaWYgKCFsb2NhdGlvblsxXSkgbG9jYXRpb25bMV0gPSAnY291bnRyeSc7XHJcbiAgICAgICAgaWYgKCFsb2NhdGlvblsxXSkgbG9jYXRpb25bMV0gPSAnY29tbWVyYyc7XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uWzFdID09PSAnY2l0eScpICRzY29wZS5jdXJyZW50VGFiID0gMjtcclxuICAgICAgICBpZiAobG9jYXRpb25bMV0gPT09ICdjb3VudHJ5JykgJHNjb3BlLmN1cnJlbnRUYWIgPSAzO1xyXG4gICAgICAgIGlmIChsb2NhdGlvblsxXSA9PT0gJ2NvbW1lcmMnKSAkc2NvcGUuY3VycmVudFRhYiA9IDQ7XHJcbiAgICAgICAgJHNjb3BlLnBhcmFtcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb3VudHJ5ID0gW107XHJcbiAgICAgICAgJHNjb3BlLmNvbW1lcmMgPSBbXTtcclxuXHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBTVEFSVCovXHJcblxyXG4gICAgICAgICRzY29wZS5zaG93Q2FsbGJhY2tQb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkKSAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kQ2FsbGJhY2tGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2FsbGJhY2tGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6LiDQodC60LjQtNC60LguJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWNhbGxiYWNrJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlNJR04gUE9QVVAgU1RBUlQqL1xyXG4gICAgICAgICRzY29wZS5zaG93U2lnblBvcHVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCkgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXNpZ24nKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kU2lnbkZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zaWduRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaWduRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQn9C+0LTQv9C40YHQutCwINC90LAgRGlzY291bnQnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5zaWduRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbkZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUuc2lnbkZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaWduRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1zaWduJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuc2lnbkZvcm0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLypTSUdOIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qUkVRVUVTVCBGT1JNIFNFTkRJTkcgU1RBUlQqL1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZE9yZGVyRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm9yZGVyRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7Qui4g0KHQutC40LTQutC4Lic7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLm9yZGVyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtcmVxdWVzdCcpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXJlcXVlc3QnKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLm9yZGVyRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzT3JkZXJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtcmVxdWVzdCcpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZFN1YkZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zdWJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1YkZvcm1EYXRhWydzdWJqZWN0J10gPSAn0J/QvtC00L/QuNGB0LrQsCDQvdCwIERpc2NvdW50JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuc3ViRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXNpZ24nKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3ViRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5zdWJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3ViRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzc3ViRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXNpZ24nKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYoJHNjb3BlLmN1cnJlbnRUYWIgPT0gMikge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2NpdHkuanNvbicpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldCcpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZsYXQgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21zOiAocGFyc2VJbnQoY3VycmVudEZsYXRbJ25iX3Jvb21zJ10pKT8gKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSsnIC0g0LrQvtC8LiDQutCyLiwgJykgOiAnICcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvcmF0aW9uOiBjdXJyZW50RmxhdC5kZWNvcmF0aW9uIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3I6IChwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikpPyAnLCAnKyhwYXJzZUludChjdXJyZW50RmxhdC5mbG9vcikgKyAnLdC5INGN0YLQsNC2JykgOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmVzdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuQWJzZW50RW1wbG95ZWVzLmVtcGxveWVlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgYWJFbXBsb3llZXMuZGF0YUxvYWRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbihpdGVtcywgYXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlW2F0dHJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGVzdCA9IGZ1bmN0aW9uKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1kaXNjb3VudF9pbm5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1mb3JtJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKSUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3NbY3VycmVudF0uY2hpbGRyZW5bY2VudGVyLTFdLmluc2VydEFmdGVyKGZvcm1zW2N1cnJlbnRdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmN1cnJlbnRUYWIgPT0gMykge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2NvdW50cnkuanNvbicpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgZGF0YS5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZsYXQgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb3VudHJ5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyYW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGN1cnJlbnRGbGF0LmRpcmVjdGlvbiArICcsICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSsnINC60Lwg0L7RgiDQnNCa0JDQlCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmU6IChwYXJzZUZsb2F0KGN1cnJlbnRGbGF0WydsYW5kX2FyZWEnXSkpPyArY3VycmVudEZsYXRbJ2xhbmRfYXJlYSddKycg0YHQvtGCLiwgJzogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZWFyZWE6IChwYXJzZUZsb2F0KGN1cnJlbnRGbGF0Wydob3VzZV9hcmVhJ10pKT8gJycrY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSsnINC8wrInOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFic2VudEVtcGxveWVlcy5lbXBsb3llZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGFiRW1wbG95ZWVzLmRhdGFMb2FkZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oaXRlbXMsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVthdHRyXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZGlzY291bnRfaW5uZXInKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZm9ybScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aCAvIDIpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3Jtc1tjdXJyZW50XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5jdXJyZW50VGFiID09IDQpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdjb21tZXJjLmpzb24nKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEuc29ydChzb3J0KTtcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGbGF0ID0gZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb21tZXJjZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lcmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQubWV0cm8rICcsICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IGN1cnJlbnRGbGF0LmFkZHJlc3MgfHwgY3VycmVudEZsYXQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5BYnNlbnRFbXBsb3llZXMuZW1wbG95ZWVzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBhYkVtcGxveWVlcy5kYXRhTG9hZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVbYXR0cl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWRpc2NvdW50X2lubmVyJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWZvcm0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpJTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGggLyAyKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbltjZW50ZXItMV0uaW5zZXJ0QWZ0ZXIoZm9ybXNbY3VycmVudF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd1NpZ25Qb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQpICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLXNpZ24nKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZnVuY3Rpb24gYWRkU3BhY2VzKG4pIHtcclxuICAgICAgICAgICAgdmFyIHJ4ID0gLyhcXGQrKShcXGR7M30pLztcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhuKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL15cXGQrLywgZnVuY3Rpb24gKHcpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocngudGVzdCh3KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3ID0gdy5yZXBsYWNlKHJ4LCAnJDEgJDInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHc7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc29ydChvYmoxLCBvYmoyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoyLmRpc2NvdW50IC0gb2JqMS5kaXNjb3VudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBhYkVtcGxveWVlcyA9ICRzY29wZS5BYnNlbnRFbXBsb3llZXM7XHJcbiAgICAgICAgYWJFbXBsb3llZXMuZGF0YUxvYWRlZCA9IGZhbHNlO1xyXG5cclxuXHJcblxyXG5cclxuICAgIH1dKTtcclxuICAgIGFwcC5kaXJlY3RpdmUoXCJyZXBlYXRFbmRcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkFcIixcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWwoYXR0cnMucmVwZWF0RW5kKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIEVsZW1lbnQucHJvdG90eXBlLmluc2VydEFmdGVyID0gZnVuY3Rpb24oZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpO1xyXG4gICAgfTtcclxufSkoKTtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgbHV6aGluLmRtIG9uIDExLjA3LjIwMTYuXHJcbiAqL1xyXG4kKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpe1xyXG5cdGlmKCQodGhpcykuc2Nyb2xsVG9wKCkgPiA1NDApIHtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLmFkZENsYXNzKCdzdGlja3knKTtcclxuXHRcdCQoXCIuZml4ZWQtaGVhZGVyXCIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

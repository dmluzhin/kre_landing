!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,r,o){function a(e){var r=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;r.test(e);)e=e.replace(r,"$1 $2");return e})}function t(e,r){return r.discount-e.discount}e.callbackFormData={},e.orderFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isSignFormSended=!1,e.isBarkliBrokerFormSended=!1,e.isOrderFormSended=!1,e.currentTab=2,e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок",r({method:"POST",url:"/sendmail.php",data:o(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var o in e.callbackFormData)e.callbackFormData[o]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3)}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Заказать обратный звонок Discount",r({method:"POST",url:"/sendmail.php",data:o(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.callbackForm.$setPristine();for(var o in e.callbackFormData)e.callbackFormData[o]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-sign").arcticmodal("close")},3e3)}))},e.sendBarkliBrokerForm=function(){e.barkliBrokerForm.$valid&&(e.barkliBrokerFormData.subject="Заявка на квартиру Discount",e.barkliBrokerFormData.email="sales@kre.ru",r({method:"POST",url:"/sendmail.php",data:o(e.barkliBrokerFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){e.barkliBrokerForm.$setPristine();for(var o in e.barkliBrokerFormData)e.barkliBrokerFormData[o]="";e.isBarkliBrokerFormSended=!0,setTimeout(function(){$(".j-popup-barkli-broker").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendOrderForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Disc",r({method:"POST",url:"/sendmail.php",data:o(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude-request").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3),e.orderForm.$setPristine();for(var o in e.orderFormData)e.orderFormData[o]="";e.isOrderFormSended=!0,setTimeout(function(){$(".j-popup-gratitude-request").arcticmodal("close")},3e3)})),console.log(e.orderForm)},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSubscribeForm=function(){e.orderForm.$valid&&(e.orderFormData.subject="Disc",r({method:"POST",url:"/sendmail.php",data:o(e.orderFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(r){$(".j-popup-gratitude").arcticmodal(),setTimeout(function(){$(".j-popup-gratitude").arcticmodal("close")},15e3),e.orderForm.$setPristine();for(var o in e.orderFormData)e.orderFormData[o]=""})),console.log(e.orderForm)},r.get("http://www.kre.ru/landing/sale/").success(function(r){r.sort(t);for(var o=0;o<r.length;o+=1){var n=r[o];"city"==n.suptype?e.params.push({id:n.id,city:!0,rooms:parseInt(n.nb_rooms)?parseInt(n.nb_rooms)+" - ком. кв., ":" ",decoration:n.decoration||"",floor:parseInt(n.floor)?", "+(parseInt(n.floor)+"-й этаж"):"",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:a(parseInt(n.old_price/1)),new_price:a(parseInt(n.new_price/1)),img:n.photo,link:n.link}):"country"==n.suptype?e.params.push({id:n.id,country:!0,desc:n.direction+" "+n.distance+" км от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)+" сот."||"",housearea:parseFloat(n.house_area)?", "+n.house_area+" м²":" ",old_price:a(parseInt(n.old_price)),new_price:a(parseInt(n.new_price)),img:n.photo,link:n.link}):"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.metro+" "+n.distance,head:n.address||n.name,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:a(parseInt(n.old_price/1)),new_price:a(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.filter=function(e,r){var o={};return angular.forEach(e,function(e,a){e[r]&&(o[a]=e)}),o},e.test=function(e){var r=0,o=document.querySelectorAll(".b-discount_inner"),a=document.querySelectorAll(".b-form");r=parseInt(o[e].children.length/2)%2?parseInt(o[e].children.length/2)+1:parseInt(o[e].children.length/2),o[e].children[r-1].insertAfter(a[e])}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,r,o){e.$last&&e.$eval(o.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNTaWduRm9ybVNlbmRlZCIsImlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCIsImlzT3JkZXJGb3JtU2VuZGVkIiwiY3VycmVudFRhYiIsInBhcmFtcyIsImNvdW50cnkiLCJjb21tZXJjIiwic2hvd0NhbGxiYWNrUG9wdXAiLCJzZW5kQ2FsbGJhY2tGb3JtIiwiY2FsbGJhY2tGb3JtIiwiJHZhbGlkIiwibWV0aG9kIiwidXJsIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInN1Y2Nlc3MiLCIkc2V0UHJpc3RpbmUiLCJwcm9wIiwic2V0VGltZW91dCIsInNob3dTaWduUG9wdXAiLCJzZW5kU2lnbkZvcm0iLCJzaWduRm9ybSIsInNpZ25Gb3JtRGF0YSIsInNlbmRCYXJrbGlCcm9rZXJGb3JtIiwiYmFya2xpQnJva2VyRm9ybSIsImdhIiwieWFDb3VudGVyMTk4OTU1MTIiLCJyZWFjaEdvYWwiLCJzZW5kT3JkZXJGb3JtIiwib3JkZXJGb3JtIiwiY29uc29sZSIsImxvZyIsInNlbmRTdWJzY3JpYmVGb3JtIiwiZ2V0IiwiaSIsImxlbmd0aCIsImN1cnJlbnRGbGF0Iiwic3VwdHlwZSIsInB1c2giLCJpZCIsImNpdHkiLCJyb29tcyIsInBhcnNlSW50IiwiZGVjb3JhdGlvbiIsImZsb29yIiwiaGVhZCIsImVzdGF0ZSIsInBhcnNlRmxvYXQiLCJzcXVhcmUiLCJhcmVhIiwib2xkX3ByaWNlIiwibmV3X3ByaWNlIiwiaW1nIiwicGhvdG8iLCJsaW5rIiwiZGVzYyIsImRpcmVjdGlvbiIsImRpc3RhbmNlIiwiaG91c2VhcmVhIiwiY29tbWVyY2UiLCJtZXRybyIsImFkZHJlc3MiLCJuYW1lIiwiZmlsdGVyIiwiaXRlbXMiLCJyZXN1bHQiLCJmb3JFYWNoIiwia2V5IiwiY3VycmVudCIsImNlbnRlciIsImJsb2NrcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1zIiwiY2hpbGRyZW4iLCJpbnNlcnRBZnRlciIsImRpcmVjdGl2ZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJlbGVtZW50IiwiYXR0cnMiLCIkbGFzdCIsIiRldmFsIiwicmVwZWF0RW5kIiwiRWxlbWVudCIsImVsZW0iLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwibmV4dFNpYmxpbmciLCJ3aW5kb3ciLCJzY3JvbGwiLCJzY3JvbGxUb3AiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIl0sIm1hcHBpbmdzIjoiQ0FHQSxXQUNJLFlBRUFBLEdBQUUsa0JBQWtCQyxHQUFHLFFBQVMsV0FDNUJELEVBQUVFLE1BQU1DLFNBQVNDLFlBQVksV0FHakNKLEVBQUUsaUJBQWlCQyxHQUFHLFVBQVcsV0FDN0JELEVBQUVFLE1BQU1HLE1BQU1DLEtBQU0sT0FBUUMsTUFBTyxZQUNwQ04sR0FBRyxXQUFZLFdBQ2RELEVBQUVFLE1BQU1HLEtBQUssT0FBUSxVQUd6QkwsRUFBRSxtQkFBbUJDLEdBQUcsVUFBVyxTQUFVTyxHQUNyQ1Is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QUV0RG1DLEVBQU9GLEdBQVNNLFNBQVNMLEVBQU8sR0FBR00sWUFBWUYsRUFBTUwsV0FLckUxRixFQUFJa0csVUFBVSxZQUFhLFdBQ3ZCLE9BQ0lDLFNBQVUsSUFDVnZCLEtBQU0sU0FBVXdCLEVBQU9DLEVBQVNDLEdBQ3hCRixFQUFNRyxPQUNOSCxFQUFNSSxNQUFNRixFQUFNRyxlQUtsQ0MsUUFBUS9HLFVBQVVzRyxZQUFjLFNBQVNVLEdBQ3JDLE1BQU9sSSxNQUFLbUksV0FBV0MsYUFBYUYsRUFBTWxJLEtBQUtxSSxpQkFNdkR2SSxFQUFFd0ksUUFBUUMsT0FBTyxXQUNiekksRUFBRUUsTUFBTXdJLFlBQWMsS0FDeEIxSSxFQUFFLGlCQUFpQjJJLFNBQVMsVUFDNUIzSSxFQUFFLGlCQUFpQjRJLFlBQVksWUFFL0I1SSxFQUFFLGlCQUFpQjRJLFlBQVksVUFDL0I1SSxFQUFFLGlCQUFpQjJJLFNBQVMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGx1emhpbi5kbSBvbiAxMS4wNy4yMDE2LlxyXG4gKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgICQoJy5qLXBvcHVwLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcykucGFyZW50KCkuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1pbnB1dC10aW1lJykub24oJ2ZvY3VzaW4nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoe3R5cGU6ICd0aW1lJywgdmFsdWU6ICcxMjowMCd9KTtcclxuICAgIH0pLm9uKCdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICQodGhpcykuYXR0cigndHlwZScsICd0ZXh0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuai1waG9uZS1tYXNrZWQnKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKCQuaW5BcnJheShlLmtleUNvZGUsIFs0NiwgOCwgOSwgMjcsIDEzLCAxMTAsIDE5MF0pICE9PSAtMSB8fFxyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID09IDY1ICYmICggZS5jdHJsS2V5ID09PSB0cnVlIHx8IGUubWV0YUtleSA9PT0gdHJ1ZSApICkgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA+PSAzNSAmJiBlLmtleUNvZGUgPD0gNDApKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChlLnNoaWZ0S2V5IHx8IChlLmtleUNvZGUgPCA0OCB8fCBlLmtleUNvZGUgPiA1NykpICYmIChlLmtleUNvZGUgPCA5NiB8fCBlLmtleUNvZGUgPiAxMDcpKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgICQoJy5qLXNjcm9sbHRvLWxpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICQuc2Nyb2xsVG8oXHJcbiAgICAgICAgICAgICQodGhpcykuZGF0YSgnc2Nyb2xsdG8tYmxvY2snKSxcclxuICAgICAgICAgICAge2R1cmF0aW9uOiA1MDB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbn0pKCk7XHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBBcnJheS5wcm90b3R5cGUubWF4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIHRoaXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBBcnJheS5wcm90b3R5cGUubWluID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KG51bGwsIHRoaXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ21haW4nLCBbXSk7XHJcblxyXG4gICAgYXBwLmNvbnRyb2xsZXIoJ21haW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSkge1xyXG5cclxuICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhID0ge307XHJcbiAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmlzT3JkZXJGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRUYWIgPSAyO1xyXG4gICAgICAgICRzY29wZS5wYXJhbXMgPSBbXTtcclxuICAgICAgICAkc2NvcGUuY291bnRyeSA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb21tZXJjID0gW107XHJcblxyXG4gICAgICAgIC8qQ0FMTEJBQ0sgUE9QVVAgU1RBUlQqL1xyXG5cclxuICAgICAgICAkc2NvcGUuc2hvd0NhbGxiYWNrUG9wdXAgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCkgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLWNhbGxiYWNrJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2VuZENhbGxiYWNrRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNhbGxiYWNrRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNC60LDQt9Cw0YLRjCDQvtCx0YDQsNGC0L3Ri9C5INC30LLQvtC90L7Quic7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NlbmRtYWlsLnBocCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UoJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1jYWxsYmFjaycpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAvKiAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpOyovXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlNJR04gUE9QVVAgU1RBUlQqL1xyXG4gICAgICAgICRzY29wZS5zaG93U2lnblBvcHVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCkgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRTaWduRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNpZ25Gb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNpZ25Gb3JtRGF0YVsnc3ViamVjdCddID0gJ9CX0LDQutCw0LfQsNGC0Ywg0L7QsdGA0LDRgtC90YvQuSDQt9Cy0L7QvdC+0LogRGlzY291bnQnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtc2lnbicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qU0lHTiBQT1BVUCBFTkQqL1xyXG5cclxuICAgICAgICAvKlNFTkRJTkcgRU1BSUwgVE8gQlJPS0VSIFNUQVJUKi9cclxuICAgICAgICAkc2NvcGUuc2VuZEJhcmtsaUJyb2tlckZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5iYXJrbGlCcm9rZXJGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhWydzdWJqZWN0J10gPSAn0JfQsNGP0LLQutCwINC90LAg0LrQstCw0YDRgtC40YDRgyBEaXNjb3VudCc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbJ2VtYWlsJ10gPSAnc2FsZXNAa3JlLnJ1JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9XHJcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbcHJvcF0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQmFya2xpQnJva2VyRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtYmFya2xpLWJyb2tlcicpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2NhbGxiYWNrJywgJ2NsaWNrIGJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHlhQ291bnRlcjE5ODk1NTEyLnJlYWNoR29hbCgnY2FsbGJhY2snKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypTRU5ESU5HIEVNQUlMIFRPIEJST0tFUiBFTkQqL1xyXG5cclxuICAgICAgICAvKlJFUVVFU1QgRk9STSBTRU5ESU5HIFNUQVJUKi9cclxuXHJcbiAgICAgICAgJHNjb3BlLnNlbmRPcmRlckZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5vcmRlckZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YVsnc3ViamVjdCddID0gJ0Rpc2MnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5vcmRlckZvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXJlcXVlc3QnKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWdyYXRpdHVkZS1yZXF1ZXN0JykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5vcmRlckZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc09yZGVyRm9ybVNlbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlLXJlcXVlc3QnKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5vcmRlckZvcm0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zaG93U2lnblBvcHVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuaXNTaWduRm9ybVNlbmRlZCkgJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtc2lnbicpLmFyY3RpY21vZGFsKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuc2VuZFN1YnNjcmliZUZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5vcmRlckZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YVsnc3ViamVjdCddID0gJ0Rpc2MnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5vcmRlckZvcm1EYXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfVxyXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLmotcG9wdXAtZ3JhdGl0dWRlJykuYXJjdGljbW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1ncmF0aXR1ZGUnKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxNTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluICRzY29wZS5vcmRlckZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlckZvcm1EYXRhW3Byb3BdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLm9yZGVyRm9ybSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKlJFUVVFU1QgRk9STSBTRU5ESU5HIEVORCovXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFNwYWNlcyhuKSB7XHJcbiAgICAgICAgICAgIHZhciByeCA9IC8oXFxkKykoXFxkezN9KS87XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxkKy8sIGZ1bmN0aW9uICh3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJ4LnRlc3QodykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHcucmVwbGFjZShyeCwgJyQxICQyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHNvcnQob2JqMSwgb2JqMikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqMi5kaXNjb3VudCAtIG9iajEuZGlzY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICRodHRwLmdldCgnaHR0cDovL3d3dy5rcmUucnUvbGFuZGluZy9zYWxlLycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICBkYXRhLnNvcnQoc29ydCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPGRhdGEubGVuZ3RoOyBpKz0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZsYXQgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NpdHknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaXR5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmRlc2M6IChwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkrJyAtINC60L7QvC4g0LrQsi4sICcrY3VycmVudEZsYXQuZGVjb3JhdGlvbisnLCAnK2N1cnJlbnRGbGF0LmZsb29yKyct0Lkg0Y3RgtCw0LYnKSwqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb29tczogKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduYl9yb29tcyddKSk/IChwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkrJyAtINC60L7QvC4g0LrQsi4sICcpIDogJyAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWNvcmF0aW9uOiBjdXJyZW50RmxhdC5kZWNvcmF0aW9uIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbG9vcjogKHBhcnNlSW50KGN1cnJlbnRGbGF0LmZsb29yKSk/ICcsICcrKHBhcnNlSW50KGN1cnJlbnRGbGF0LmZsb29yKSArICct0Lkg0Y3RgtCw0LYnKSA6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmFyZWEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBjdXJyZW50RmxhdC5saW5rXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb3VudHJ5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQuZGlyZWN0aW9uICsgJyAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UrJyDQutC8INC+0YIg0JzQmtCQ0JQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0WydsYW5kX2FyZWEnXSkrJyDRgdC+0YIuJyB8fCAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VhcmVhOiAocGFyc2VGbG9hdChjdXJyZW50RmxhdFsnaG91c2VfYXJlYSddKSk/ICcsICcrY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSsnINC8wrInOiAnICcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10pKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudEZsYXQuc3VwdHlwZSA9PSAnY29tbWVyY2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tZXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQubWV0cm8rICcgJyArIGN1cnJlbnRGbGF0LmRpc3RhbmNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5hZGRyZXNzIHx8IGN1cnJlbnRGbGF0Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmFyZWEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBjdXJyZW50RmxhdC5saW5rXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oaXRlbXMsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVthdHRyXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRlc3QgPSBmdW5jdGlvbihjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWRpc2NvdW50X2lubmVyJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmItZm9ybScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKSUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlciA9IHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGggLyAyKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoLzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBibG9ja3NbY3VycmVudF0uY2hpbGRyZW5bY2VudGVyLTFdLmluc2VydEFmdGVyKGZvcm1zW2N1cnJlbnRdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xyXG4gICAgYXBwLmRpcmVjdGl2ZShcInJlcGVhdEVuZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJGxhc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5yZXBlYXRFbmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgRWxlbWVudC5wcm90b3R5cGUuaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbihlbGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbSwgdGhpcy5uZXh0U2libGluZyk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG4vKipcclxuICogQ3JlYXRlZCBieSBsdXpoaW4uZG0gb24gMTEuMDcuMjAxNi5cclxuICovXHJcbiQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCl7XHJcblx0aWYoJCh0aGlzKS5zY3JvbGxUb3AoKSA+IDU0MCkge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH0gZWxzZSB7XHJcblx0XHQkKFwiLmZpeGVkLWhlYWRlclwiKS5yZW1vdmVDbGFzcygnc3RpY2t5Jyk7XHJcblx0XHQkKFwiLmZpeGVkLWhlYWRlclwiKS5hZGRDbGFzcygnaGlkZGVuJyk7XHJcblx0fVxyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

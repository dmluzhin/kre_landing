!function(){"use strict";$(".j-popup-close").on("click",function(){$(this).parent().arcticmodal("close")}),$(".j-input-time").on("focusin",function(){$(this).attr({type:"time",value:"12:00"})}).on("focusout",function(){$(this).attr("type","text")}),$(".j-phone-masked").on("keydown",function(e){$.inArray(e.keyCode,[46,8,9,27,13,110,190])!==-1||65==e.keyCode&&(e.ctrlKey===!0||e.metaKey===!0)||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>107)&&e.preventDefault()}),$(".j-scrollto-link").on("click",function(e){return $.scrollTo($(this).data("scrollto-block"),{duration:500}),!1})}(),function(){"use strict";Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var e=angular.module("main",[]);e.controller("mainController",["$scope","$http","$httpParamSerializerJQLike",function(e,a,r){function t(e){var a=/(\d+)(\d{3})/;return String(e).replace(/^\d+/,function(e){for(;a.test(e);)e=e.replace(a,"$1 $2");return e})}function o(e,a){return a.discount-e.discount}e.callbackFormData={},e.orderFormData={},e.barkliBrokerFormData={},e.isCallbackFormSended=!1,e.isBarkliBrokerFormSended=!1,e.currentTab=2,e.params=[],e.country=[],e.commerc=[],e.showCallbackPopup=function(){e.isCallbackFormSended&&(e.isCallbackFormSended=!1),$(".j-popup-callback").arcticmodal()},e.sendCallbackForm=function(){e.callbackForm.$valid&&(e.callbackFormData.subject="Заказать обратный звонок",a({method:"POST",url:"/sendmail.php",data:r(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){e.callbackForm.$setPristine();for(var r in e.callbackFormData)e.callbackFormData[r]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-callback").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.showSignPopup=function(){e.isSignFormSended&&(e.isSignFormSended=!1),$(".j-popup-sign").arcticmodal()},e.sendSignForm=function(){e.signForm.$valid&&(e.signFormData.subject="Заказать обратный звонок Discount",a({method:"POST",url:"/sendmail.php",data:r(e.callbackFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){e.callbackForm.$setPristine();for(var r in e.callbackFormData)e.callbackFormData[r]="";e.isCallbackFormSended=!0,setTimeout(function(){$(".j-popup-sign").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},e.sendBarkliBrokerForm=function(){e.barkliBrokerForm.$valid&&(e.barkliBrokerFormData.subject="Заявка на квартиру Discount",e.barkliBrokerFormData.email="sales@kre.ru",a({method:"POST",url:"/sendmail.php",data:r(e.barkliBrokerFormData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){e.barkliBrokerForm.$setPristine();for(var r in e.barkliBrokerFormData)e.barkliBrokerFormData[r]="";e.isBarkliBrokerFormSended=!0,setTimeout(function(){$(".j-popup-barkli-broker").arcticmodal("close")},3e3),ga("send","event","callback","click button"),yaCounter19895512.reachGoal("callback")}))},a.get("http://www.kre.ru/landing/sale/").success(function(a){a.sort(o);for(var r=0;r<a.length;r+=1){var n=a[r];"city"==n.suptype?e.params.push({id:n.id,city:!0,desc:parseInt(n.nb_rooms)+" - ком. кв., "+n.decoration+", "+n.floor+"-й этаж",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:n.link}):"country"==n.suptype?e.params.push({id:n.id,country:!0,desc:n.direction+" "+n.distance+" км от МКАД",head:n.estate,discount:parseFloat(n.discount),square:parseFloat(n.land_area)+" сот., ",housearea:parseFloat(n.house_area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:n.link}):"commerce"==n.suptype&&e.params.push({id:n.id,commerce:!0,desc:n.metro+" "+n.distance,head:n.address||n.name,discount:parseFloat(n.discount),square:parseFloat(n.area),old_price:t(parseInt(n.old_price/1)),new_price:t(parseInt(n.new_price/1)),img:n.photo,link:n.link}),e.filter=function(e,a){var r={};return angular.forEach(e,function(e,t){e[a]&&(r[t]=e)}),r},e.test=function(e){var a=0,r=document.querySelectorAll(".b-discount_inner"),t=document.querySelectorAll(".b-form");a=parseInt(r[e].children.length/2)%2?parseInt(r[e].children.length/2)+1:parseInt(r[e].children.length/2),r[e].children[a-1].insertAfter(t[e].cloneNode(!0)),t[e].parentNode.removeChild(t[e])}}})}]),e.directive("repeatEnd",function(){return{restrict:"A",link:function(e,a,r){e.$last&&e.$eval(r.repeatEnd)}}}),Element.prototype.insertAfter=function(e){return this.parentNode.insertBefore(e,this.nextSibling)}}(),$(window).scroll(function(){$(this).scrollTop()>540?($(".fixed-header").addClass("sticky"),$(".fixed-header").removeClass("hidden")):($(".fixed-header").removeClass("sticky"),$(".fixed-header").addClass("hidden"))});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm9uIiwidGhpcyIsInBhcmVudCIsImFyY3RpY21vZGFsIiwiYXR0ciIsInR5cGUiLCJ2YWx1ZSIsImUiLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsImV2ZW50Iiwic2Nyb2xsVG8iLCJkYXRhIiwiZHVyYXRpb24iLCJBcnJheSIsInByb3RvdHlwZSIsIm1heCIsIk1hdGgiLCJhcHBseSIsIm1pbiIsImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGh0dHAiLCIkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSIsImFkZFNwYWNlcyIsIm4iLCJyeCIsIlN0cmluZyIsInJlcGxhY2UiLCJ3IiwidGVzdCIsInNvcnQiLCJvYmoxIiwib2JqMiIsImRpc2NvdW50IiwiY2FsbGJhY2tGb3JtRGF0YSIsIm9yZGVyRm9ybURhdGEiLCJiYXJrbGlCcm9rZXJGb3JtRGF0YSIsImlzQ2FsbGJhY2tGb3JtU2VuZGVkIiwiaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkIiwiY3VycmVudFRhYiIsInBhcmFtcyIsImNvdW50cnkiLCJjb21tZXJjIiwic2hvd0NhbGxiYWNrUG9wdXAiLCJzZW5kQ2FsbGJhY2tGb3JtIiwiY2FsbGJhY2tGb3JtIiwiJHZhbGlkIiwibWV0aG9kIiwidXJsIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsInN1Y2Nlc3MiLCIkc2V0UHJpc3RpbmUiLCJwcm9wIiwic2V0VGltZW91dCIsImdhIiwieWFDb3VudGVyMTk4OTU1MTIiLCJyZWFjaEdvYWwiLCJzaG93U2lnblBvcHVwIiwiaXNTaWduRm9ybVNlbmRlZCIsInNlbmRTaWduRm9ybSIsInNpZ25Gb3JtIiwic2lnbkZvcm1EYXRhIiwic2VuZEJhcmtsaUJyb2tlckZvcm0iLCJiYXJrbGlCcm9rZXJGb3JtIiwiZ2V0IiwiaSIsImxlbmd0aCIsImN1cnJlbnRGbGF0Iiwic3VwdHlwZSIsInB1c2giLCJpZCIsImNpdHkiLCJkZXNjIiwicGFyc2VJbnQiLCJkZWNvcmF0aW9uIiwiZmxvb3IiLCJoZWFkIiwiZXN0YXRlIiwicGFyc2VGbG9hdCIsInNxdWFyZSIsImFyZWEiLCJvbGRfcHJpY2UiLCJuZXdfcHJpY2UiLCJpbWciLCJwaG90byIsImxpbmsiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsImhvdXNlYXJlYSIsImNvbW1lcmNlIiwibWV0cm8iLCJhZGRyZXNzIiwibmFtZSIsImZpbHRlciIsIml0ZW1zIiwicmVzdWx0IiwiZm9yRWFjaCIsImtleSIsImN1cnJlbnQiLCJjZW50ZXIiLCJibG9ja3MiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JtcyIsImNoaWxkcmVuIiwiaW5zZXJ0QWZ0ZXIiLCJjbG9uZU5vZGUiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJzIiwiJGxhc3QiLCIkZXZhbCIsInJlcGVhdEVuZCIsIkVsZW1lbnQiLCJlbGVtIiwiaW5zZXJ0QmVmb3JlIiwibmV4dFNpYmxpbmciLCJ3aW5kb3ciLCJzY3JvbGwiLCJzY3JvbGxUb3AiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIl0sIm1hcHBpbmdzIjoiQ0FHQSxXQUNJLFlBRUFBLEdBQUUsa0JBQWtCQyxHQUFHLFFBQVMsV0FDNUJELEVBQUVFLE1BQU1DLFNBQVNDLFlBQVksV0FHakNKLEVBQUUsaUJBQWlCQyxHQUFHLFVBQVcsV0FDN0JELEVBQUVFLE1BQU1HLE1BQU1DLEtBQU0sT0FBUUMsTUFBTyxZQUNwQ04sR0FBRyxXQUFZLFdBQ2RELEVBQUVFLE1BQU1HLEtBQUssT0FBUSxVQUd6QkwsRUFBRSxtQkFBbUJDLEdBQUcsVUFBVyxTQUFVTyxHQUNyQ1IsRUFBRVMsUUFBUUQsRUFBRUUsU0FBVSxHQUFJLEVBQUcsRUFBRyxHQUFJLEdBQUksSUFBSyxZQUMvQixJQUFiRixF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QVNNLFNBQVNMLEVBQU8sR0FBR00sWUFBWUYsRUFBTUwsR0FBU1EsV0FBVSxJQUN4RUgsRUFBTUwsR0FBU1MsV0FBV0MsWUFBWUwsRUFBTUwsV0FLNURuRixFQUFJOEYsVUFBVSxZQUFhLFdBQ3ZCLE9BQ0lDLFNBQVUsSUFDVnpCLEtBQU0sU0FBVTBCLEVBQU9DLEVBQVNDLEdBQ3hCRixFQUFNRyxPQUNOSCxFQUFNSSxNQUFNRixFQUFNRyxlQUtsQ0MsUUFBUTNHLFVBQVUrRixZQUFjLFNBQVNhLEdBQ3JDLE1BQU85SCxNQUFLbUgsV0FBV1ksYUFBYUQsRUFBTTlILEtBQUtnSSxpQkFrQnZEbEksRUFBRW1JLFFBQVFDLE9BQU8sV0FDYnBJLEVBQUVFLE1BQU1tSSxZQUFjLEtBQ3hCckksRUFBRSxpQkFBaUJzSSxTQUFTLFVBQzVCdEksRUFBRSxpQkFBaUJ1SSxZQUFZLFlBRS9CdkksRUFBRSxpQkFBaUJ1SSxZQUFZLFVBQy9CdkksRUFBRSxpQkFBaUJzSSxTQUFTIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBsdXpoaW4uZG0gb24gMTEuMDcuMjAxNi5cclxuICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAkKCcuai1wb3B1cC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFyY3RpY21vZGFsKCdjbG9zZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotaW5wdXQtdGltZScpLm9uKCdmb2N1c2luJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5hdHRyKHt0eXBlOiAndGltZScsIHZhbHVlOiAnMTI6MDAnfSk7XHJcbiAgICB9KS5vbignZm9jdXNvdXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoJ3R5cGUnLCAndGV4dCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnLmotcGhvbmUtbWFza2VkJykub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmICgkLmluQXJyYXkoZS5rZXlDb2RlLCBbNDYsIDgsIDksIDI3LCAxMywgMTEwLCAxOTBdKSAhPT0gLTEgfHxcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA9PSA2NSAmJiAoIGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUgKSApIHx8XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDQwKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoZS5zaGlmdEtleSB8fCAoZS5rZXlDb2RlIDwgNDggfHwgZS5rZXlDb2RlID4gNTcpKSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA3KSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAkKCcuai1zY3JvbGx0by1saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAkLnNjcm9sbFRvKFxyXG4gICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3Njcm9sbHRvLWJsb2NrJyksXHJcbiAgICAgICAgICAgIHtkdXJhdGlvbjogNTAwfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcblxyXG59KSgpO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbi5hcHBseShudWxsLCB0aGlzKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtYWluJywgW10pO1xyXG5cclxuICAgIGFwcC5jb250cm9sbGVyKCdtYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRodHRwJywgJyRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGh0dHBQYXJhbVNlcmlhbGl6ZXJKUUxpa2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGEgPSB7fTtcclxuICAgICAgICAkc2NvcGUub3JkZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSA9IHt9O1xyXG4gICAgICAgICRzY29wZS5pc0NhbGxiYWNrRm9ybVNlbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5pc0JhcmtsaUJyb2tlckZvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuY3VycmVudFRhYiA9IDI7XHJcbiAgICAgICAgJHNjb3BlLnBhcmFtcyA9IFtdO1xyXG4gICAgICAgICRzY29wZS5jb3VudHJ5ID0gW107XHJcbiAgICAgICAgJHNjb3BlLmNvbW1lcmMgPSBbXTtcclxuXHJcbiAgICAgICAgLypDQUxMQkFDSyBQT1BVUCBTVEFSVCovXHJcblxyXG4gICAgICAgICRzY29wZS5zaG93Q2FsbGJhY2tQb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzQ2FsbGJhY2tGb3JtU2VuZGVkKSAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJCgnLmotcG9wdXAtY2FsbGJhY2snKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kQ2FsbGJhY2tGb3JtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY2FsbGJhY2tGb3JtLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNhbGxiYWNrRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLWNhbGxiYWNrJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qQ0FMTEJBQ0sgUE9QVVAgRU5EKi9cclxuXHJcbiAgICAgICAgLypTSUdOIFBPUFVQIFNUQVJUKi9cclxuICAgICAgICAkc2NvcGUuc2hvd1NpZ25Qb3B1cCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmlzU2lnbkZvcm1TZW5kZWQpICRzY29wZS5pc1NpZ25Gb3JtU2VuZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICQoJy5qLXBvcHVwLXNpZ24nKS5hcmN0aWNtb2RhbCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zZW5kU2lnbkZvcm0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zaWduRm9ybS4kdmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaWduRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0LrQsNC30LDRgtGMINC+0LHRgNCw0YLQvdGL0Lkg0LfQstC+0L3QvtC6IERpc2NvdW50JztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2VuZG1haWwucGhwJyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkaHR0cFBhcmFtU2VyaWFsaXplckpRTGlrZSgkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jYWxsYmFja0Zvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FsbGJhY2tGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNDYWxsYmFja0Zvcm1TZW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qLXBvcHVwLXNpZ24nKS5hcmN0aWNtb2RhbCgnY2xvc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdjYWxsYmFjaycsICdjbGljayBidXR0b24nKTtcclxuICAgICAgICAgICAgICAgICAgICB5YUNvdW50ZXIxOTg5NTUxMi5yZWFjaEdvYWwoJ2NhbGxiYWNrJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLypTSUdOIFBPUFVQIEVORCovXHJcblxyXG4gICAgICAgIC8qU0VORElORyBFTUFJTCBUTyBCUk9LRVIgU1RBUlQqL1xyXG4gICAgICAgICRzY29wZS5zZW5kQmFya2xpQnJva2VyRm9ybSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmJhcmtsaUJyb2tlckZvcm0uJHZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmFya2xpQnJva2VyRm9ybURhdGFbJ3N1YmplY3QnXSA9ICfQl9Cw0Y/QstC60LAg0L3QsCDQutCy0LDRgNGC0LjRgNGDIERpc2NvdW50JztcclxuICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YVsnZW1haWwnXSA9ICdzYWxlc0BrcmUucnUnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZW5kbWFpbC5waHAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRodHRwUGFyYW1TZXJpYWxpemVySlFMaWtlKCRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ31cclxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gJHNjb3BlLmJhcmtsaUJyb2tlckZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXJrbGlCcm9rZXJGb3JtRGF0YVtwcm9wXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNCYXJrbGlCcm9rZXJGb3JtU2VuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuai1wb3B1cC1iYXJrbGktYnJva2VyJykuYXJjdGljbW9kYWwoJ2Nsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnY2FsbGJhY2snLCAnY2xpY2sgYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWFDb3VudGVyMTk4OTU1MTIucmVhY2hHb2FsKCdjYWxsYmFjaycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKlNFTkRJTkcgRU1BSUwgVE8gQlJPS0VSIEVORCovXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFNwYWNlcyhuKSB7XHJcbiAgICAgICAgICAgIHZhciByeCA9IC8oXFxkKykoXFxkezN9KS87XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcobilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxkKy8sIGZ1bmN0aW9uICh3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHJ4LnRlc3QodykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHcucmVwbGFjZShyeCwgJyQxICQyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB3O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHNvcnQob2JqMSwgb2JqMikge1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqMi5kaXNjb3VudCAtIG9iajEuZGlzY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICRodHRwLmdldCgnaHR0cDovL3d3dy5rcmUucnUvbGFuZGluZy9zYWxlLycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICBkYXRhLnNvcnQoc29ydCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPGRhdGEubGVuZ3RoOyBpKz0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZsYXQgPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NpdHknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnBhcmFtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGN1cnJlbnRGbGF0LmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaXR5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjOiBwYXJzZUludChjdXJyZW50RmxhdFsnbmJfcm9vbXMnXSkrJyAtINC60L7QvC4g0LrQsi4sICcrY3VycmVudEZsYXQuZGVjb3JhdGlvbisnLCAnK2N1cnJlbnRGbGF0LmZsb29yKyct0Lkg0Y3RgtCw0LYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmFyZWEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnb2xkX3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdfcHJpY2U6IGFkZFNwYWNlcyhwYXJzZUludChjdXJyZW50RmxhdFsnbmV3X3ByaWNlJ10vMSkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGN1cnJlbnRGbGF0LnBob3RvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBjdXJyZW50RmxhdC5saW5rXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50RmxhdC5zdXB0eXBlID09ICdjb3VudHJ5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzogY3VycmVudEZsYXQuZGlyZWN0aW9uICsgJyAnICsgY3VycmVudEZsYXQuZGlzdGFuY2UrJyDQutC8INC+0YIg0JzQmtCQ0JQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBjdXJyZW50RmxhdC5lc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2NvdW50OiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0LmRpc2NvdW50KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3F1YXJlOiBwYXJzZUZsb2F0KGN1cnJlbnRGbGF0WydsYW5kX2FyZWEnXSkrJyDRgdC+0YIuLCAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBob3VzZWFyZWE6IHBhcnNlRmxvYXQoY3VycmVudEZsYXRbJ2hvdXNlX2FyZWEnXSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WydvbGRfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wcmljZTogYWRkU3BhY2VzKHBhcnNlSW50KGN1cnJlbnRGbGF0WyduZXdfcHJpY2UnXS8xKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZzogY3VycmVudEZsYXQucGhvdG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IGN1cnJlbnRGbGF0LmxpbmtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRGbGF0LnN1cHR5cGUgPT0gJ2NvbW1lcmNlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5wYXJhbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjdXJyZW50RmxhdC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVyY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2M6IGN1cnJlbnRGbGF0Lm1ldHJvKyAnICcgKyBjdXJyZW50RmxhdC5kaXN0YW5jZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogY3VycmVudEZsYXQuYWRkcmVzcyB8fCBjdXJyZW50RmxhdC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjb3VudDogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5kaXNjb3VudCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZTogcGFyc2VGbG9hdChjdXJyZW50RmxhdC5hcmVhKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ29sZF9wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3ByaWNlOiBhZGRTcGFjZXMocGFyc2VJbnQoY3VycmVudEZsYXRbJ25ld19wcmljZSddLzEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nOiBjdXJyZW50RmxhdC5waG90byxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluazogY3VycmVudEZsYXQubGlua1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKGl0ZW1zLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVbYXR0cl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50ZXN0ID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYi1kaXNjb3VudF9pbm5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5iLWZvcm0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGJsb2Nrc1tjdXJyZW50XS5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9ja3NbY3VycmVudF0uY2hpbGRyZW4ubGVuZ3RoIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gcGFyc2VJbnQoYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuLmxlbmd0aC8yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2tzW2N1cnJlbnRdLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3Jtc1tjdXJyZW50XS5jbG9uZU5vZGUodHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1zW2N1cnJlbnRdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZm9ybXNbY3VycmVudF0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XHJcbiAgICBhcHAuZGlyZWN0aXZlKFwicmVwZWF0RW5kXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJBXCIsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS4kbGFzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsKGF0dHJzLnJlcGVhdEVuZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICBFbGVtZW50LnByb3RvdHlwZS5pbnNlcnRBZnRlciA9IGZ1bmN0aW9uKGVsZW0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtLCB0aGlzLm5leHRTaWJsaW5nKTtcclxuICAgIH07XHJcbiAgIHZhciAgdGVzdCA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgY2VudGVyID0gMCwgYmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYi1kaXNjb3VudF9pbm5lcicpLCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmItZm9ybScpO1xyXG4gICAgICAgIGlmIChwYXJzZUludChibG9jay5jaGlsZHJlbi5sZW5ndGgvMiklMikge1xyXG4gICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9jay5jaGlsZHJlbi5sZW5ndGggLyAyKSArIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjZW50ZXIgPSBwYXJzZUludChibG9jay5jaGlsZHJlbi5sZW5ndGgvMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJsb2NrLmNoaWxkcmVuW2NlbnRlci0xXS5pbnNlcnRBZnRlcihmb3JtLmNsb25lTm9kZSh0cnVlKSk7XHJcbiAgICAgICAgZm9ybS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZvcm0pO1xyXG4gICAgfVxyXG59KSgpO1xyXG4vKipcclxuICogQ3JlYXRlZCBieSBsdXpoaW4uZG0gb24gMTEuMDcuMjAxNi5cclxuICovXHJcbiQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCl7XHJcblx0aWYoJCh0aGlzKS5zY3JvbGxUb3AoKSA+IDU0MCkge1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikuYWRkQ2xhc3MoJ3N0aWNreScpO1xyXG5cdFx0JChcIi5maXhlZC1oZWFkZXJcIikucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xyXG5cdH0gZWxzZSB7XHJcblx0XHQkKFwiLmZpeGVkLWhlYWRlclwiKS5yZW1vdmVDbGFzcygnc3RpY2t5Jyk7XHJcblx0XHQkKFwiLmZpeGVkLWhlYWRlclwiKS5hZGRDbGFzcygnaGlkZGVuJyk7XHJcblx0fVxyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
